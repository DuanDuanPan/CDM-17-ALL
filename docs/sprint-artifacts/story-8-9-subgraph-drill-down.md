# Story 8.9: å­å›¾ä¸‹é’»å¯¼èˆª (Subgraph Drill-Down Navigation)

Status: done
Tech-Spec: [tech-spec-8-9-subgraph-drill-down.md](./tech-spec-8-9-subgraph-drill-down.md)

<!-- Note: Validation is optional. Run validate-create-story for quality check before dev-story. -->

## Story

As a **ç”¨æˆ·**,
I want **é€šè¿‡å³é”®èœå•æˆ–å¿«æ·é”®è¿›å…¥èŠ‚ç‚¹çš„å­å›¾è§†å›¾ï¼Œå¹¶é€šè¿‡é¢åŒ…å±‘å¯¼èˆªè¿”å›**,
so that **æˆ‘èƒ½æ·±å…¥æ¢ç´¢å¤æ‚å­ç³»ç»Ÿçš„ç»†èŠ‚ï¼ŒåŒæ—¶ä¿æŒä¸çˆ¶å›¾çš„ä¸Šä¸‹æ–‡å…³è”ã€‚**

## Problem Statement

åœ¨å¤„ç†å¤§è§„æ¨¡å¤æ‚å›¾è°±ï¼ˆ500-5000+ èŠ‚ç‚¹ï¼‰æ—¶ï¼Œç”¨æˆ·é¢ä¸´ä»¥ä¸‹ç—›ç‚¹ï¼š

1. **è§†è§‰è¿‡è½½**ï¼šå¤§é‡èŠ‚ç‚¹åŒæ—¶å±•ç¤ºå¯¼è‡´ä¿¡æ¯è¿‡è½½ï¼Œéš¾ä»¥èšç„¦ç‰¹å®šå­ç³»ç»Ÿ
2. **ä¸Šä¸‹æ–‡ä¸¢å¤±**ï¼šç¼©æ”¾æŸ¥çœ‹ç»†èŠ‚æ—¶å®¹æ˜“è¿·å¤±å½“å‰ä½ç½®ä¸æ•´ä½“ç»“æ„çš„å…³ç³»
3. **åä½œå›°éš¾**ï¼šå¤šäººååŒæ—¶ï¼Œä¸åŒç”¨æˆ·å¯èƒ½åœ¨æŸ¥çœ‹åŒä¸€å›¾è°±çš„ä¸åŒ"æ·±åº¦"ï¼Œç¼ºä¹åŒæ­¥æœºåˆ¶
4. **å¯¼èˆªæ•ˆç‡ä½**ï¼šé¢‘ç¹ç¼©æ”¾å’Œå¹³ç§»æ¥æŸ¥çœ‹ä¸åŒå±‚çº§ï¼Œæ•ˆç‡ä½ä¸‹

å­å›¾ä¸‹é’»å¯¼èˆªé€šè¿‡å…è®¸ç”¨æˆ·"è¿›å…¥"ä»»æ„èŠ‚ç‚¹æŸ¥çœ‹å…¶å­æ ‘ä½œä¸ºç‹¬ç«‹å­å›¾ï¼Œç»“åˆé¢åŒ…å±‘å¯¼èˆªæä¾›æ¸…æ™°çš„å±‚çº§è·¯å¾„ï¼Œå¹¶ç¡®ä¿å­å›¾å†…çš„æ•°æ®å˜æ›´é€šè¿‡ Yjs ä¸å…¶ä»–å®¢æˆ·ç«¯å®æ—¶åŒæ­¥ï¼ˆä¸‹é’»è·¯å¾„æœ¬èº«ä¸åŒæ­¥ï¼‰ã€‚

## Scope

**In Scope:**
- âœ… å­å›¾ä¸‹é’»å…¥å£ï¼šå³é”®èœå•"è¿›å…¥å­å›¾"æˆ–å¿«æ·é”® `Cmd/Ctrl+Enter`ï¼ˆæœ‰å­èŠ‚ç‚¹æ—¶å¯ç”¨ï¼‰
- âœ… é¢åŒ…å±‘å¯¼èˆªæ ï¼šæ˜¾ç¤ºå½“å‰è·¯å¾„ï¼ˆæ ¹ â†’ çˆ¶èŠ‚ç‚¹ â†’ å½“å‰èŠ‚ç‚¹ï¼‰ï¼Œç‚¹å‡»å¯å¿«é€Ÿè¿”å›
- âœ… å­å›¾è§†å›¾æ¸²æŸ“ï¼šä»¥é€‰ä¸­èŠ‚ç‚¹ä¸ºæ–°çš„"æ ¹"ï¼Œåªæ¸²æŸ“å…¶ç›´æ¥å­æ ‘
- âœ… ä¸‹é’»çŠ¶æ€æŒä¹…åŒ–ï¼šåˆ·æ–°é¡µé¢åä¿æŒå½“å‰ä¸‹é’»ä½ç½®ï¼ˆURL hash + sessionStorageï¼‰
- âœ… è¿”å›ä¸Šå±‚ï¼šé€šè¿‡ç‚¹å‡»é¢åŒ…å±‘å¯¼èˆªè¿”å›ï¼ˆæ— ä¸“ç”¨å¿«æ·é”®ï¼‰

**Out of Scope:**
- âŒ å¤šå®¢æˆ·ç«¯ä¸‹é’»è·¯å¾„åŒæ­¥ï¼ˆYjs Awarenessï¼‰â€”â€” ä¸‹é’»æ˜¯æœ¬åœ°è§†å›¾çŠ¶æ€
- âŒ åŒå‡»ä¸‹é’»ï¼ˆåŒå‡»ä¿æŒç°æœ‰ç¼–è¾‘æ¨¡å¼è¡Œä¸ºï¼‰
- âŒ è¿”å›ä¸Šå±‚å¿«æ·é”®ï¼ˆä»…é€šè¿‡é¢åŒ…å±‘å¯¼èˆªè¿”å›ï¼‰
- âŒ è·¨å›¾å¼•ç”¨ä¸è¡€ç¼˜å¯è§†åŒ–ï¼ˆStory 5.3ï¼‰
- âŒ å­å›¾ç‹¬ç«‹æƒé™æ§åˆ¶ï¼ˆEpic 3 å®‰å…¨ç›¸å…³ï¼‰
- âŒ å­å›¾å¯¼å‡ºä¸ºç‹¬ç«‹æ–‡ä»¶ï¼ˆEpic 3 å¯¼å‡ºç›¸å…³ï¼‰
- âŒ ä¸‹é’»åŠ¨ç”»çš„å¤æ‚è¿‡æ¸¡æ•ˆæœï¼ˆå¯åœ¨åç»­è¿­ä»£å¢å¼ºï¼‰

---

## Acceptance Criteria (éªŒæ”¶æ ‡å‡†)

### AC1: å³é”®èœå•è¿›å…¥å­å›¾
**Given** ä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹
**When** å³é”®èŠ‚ç‚¹å¹¶é€‰æ‹©"è¿›å…¥å­å›¾"ï¼ˆæˆ–é€‰ä¸­åæŒ‰ `Cmd/Ctrl+Enter`ï¼‰
**Then** è§†å›¾åº”åˆ‡æ¢ä¸ºä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­å›¾è§†å›¾
**And** åªæ˜¾ç¤ºè¯¥èŠ‚ç‚¹åŠå…¶æ‰€æœ‰åä»£èŠ‚ç‚¹
**And** åˆ‡æ¢åº”æœ‰å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»ï¼ˆéµå®ˆ `prefers-reduced-motion`ï¼‰

### AC2: é¢åŒ…å±‘å¯¼èˆªæ˜¾ç¤ºä¸äº¤äº’
**Given** ç”¨æˆ·å·²ä¸‹é’»åˆ°æŸä¸ªæ·±å±‚èŠ‚ç‚¹
**When** æŸ¥çœ‹ç”»å¸ƒé¡¶éƒ¨
**Then** åº”æ˜¾ç¤ºé¢åŒ…å±‘è·¯å¾„ï¼ˆå¦‚ï¼šæ ¹ä¸»é¢˜ â€º ç³»ç»Ÿè®¾è®¡ â€º åç«¯æ¶æ„ï¼‰
**When** ç‚¹å‡»é¢åŒ…å±‘ä¸­çš„ä»»æ„å±‚çº§
**Then** è§†å›¾åº”å¿«é€Ÿåˆ‡æ¢åˆ°å¯¹åº”å±‚çº§çš„å­å›¾
**And** é¢åŒ…å±‘åº”æ›´æ–°ä¸ºæ–°çš„è·¯å¾„

### AC3: é€šè¿‡é¢åŒ…å±‘è¿”å›ä¸Šå±‚
**Given** ç”¨æˆ·å¤„äºä¸‹é’»çš„å­å›¾è§†å›¾ä¸­
**When** ç‚¹å‡»é¢åŒ…å±‘ä¸­çš„çˆ¶å±‚çº§é¡¹
**Then** åº”è¿”å›å¯¹åº”å±‚çº§çš„å­å›¾è§†å›¾
**When** ç‚¹å‡»é¢åŒ…å±‘æ ¹èŠ‚ç‚¹ï¼ˆHome å›¾æ ‡ï¼‰
**Then** åº”è¿”å›ä¸»å›¾è§†å›¾
**And** é¢åŒ…å±‘è·¯å¾„åº”æ­£ç¡®æ›´æ–°

### AC4: å­å›¾æ•°æ®å˜æ›´è‡ªåŠ¨åŒæ­¥
**Given** ç”¨æˆ·Aåœ¨å­å›¾è§†å›¾ä¸­ï¼Œç”¨æˆ·Båœ¨ä¸»å›¾æˆ–å…¶ä»–å­å›¾è§†å›¾ä¸­
**When** ç”¨æˆ·Aåœ¨å­å›¾ä¸­æ·»åŠ /ä¿®æ”¹/åˆ é™¤èŠ‚ç‚¹
**Then** ç”¨æˆ·Båº”èƒ½å®æ—¶çœ‹åˆ°æ•°æ®å˜æ›´ï¼ˆå³ä½¿åœ¨ä¸åŒè§†å›¾å±‚çº§ï¼‰
**When** ç”¨æˆ·Bè¿”å›ä¸»å›¾æˆ–è¿›å…¥åŒ…å«è¯¥èŠ‚ç‚¹çš„å­å›¾
**Then** ç”¨æˆ·Båº”èƒ½çœ‹åˆ°ç”¨æˆ·Aæ·»åŠ çš„æ–°èŠ‚ç‚¹
**And** ä¸‹é’»è·¯å¾„æ˜¯æœ¬åœ°è§†å›¾çŠ¶æ€ï¼Œä¸åœ¨å®¢æˆ·ç«¯é—´åŒæ­¥ï¼ˆæ—  Awareness åŒæ­¥ï¼‰

### AC5: ä¸‹é’»çŠ¶æ€æŒä¹…åŒ–
**Given** ç”¨æˆ·å·²ä¸‹é’»åˆ°æŸä¸ªæ·±å±‚èŠ‚ç‚¹
**When** åˆ·æ–°é¡µé¢æˆ–å…³é—­åé‡æ–°æ‰“å¼€
**Then** è§†å›¾åº”æ¢å¤åˆ°åˆ·æ–°å‰çš„ä¸‹é’»ä½ç½®
**And** é¢åŒ…å±‘åº”æ­£ç¡®æ˜¾ç¤ºå®Œæ•´è·¯å¾„

### AC6: å¶å­èŠ‚ç‚¹ä¸å¯ä¸‹é’»
**Given** ä¸€ä¸ªæ²¡æœ‰å­èŠ‚ç‚¹çš„å¶å­èŠ‚ç‚¹
**When** å³é”®è¯¥èŠ‚ç‚¹
**Then** èœå•ä¸­ä¸åº”æ˜¾ç¤º"è¿›å…¥å­å›¾"é€‰é¡¹ï¼ˆæˆ–æ˜¾ç¤ºä¸ºç°è‰²ç¦ç”¨ï¼‰

---

## ğŸ¨ High-Precision UI Design Specification (é«˜ç²¾åº¦ UI è®¾è®¡è§„èŒƒ)

![Subgraph Drill-Down UI Concept](../prototypes/story-8-9/subgraph-drill-down-ui.png)

> **Design Philosophy**: éµå¾ª "Arc/Linear" é£æ ¼çš„é«˜ç«¯æš—è‰²æ¨¡å¼ç¾å­¦ã€‚å¼ºè°ƒ "Functional Elegance"ï¼ˆåŠŸèƒ½ä¼˜é›…ï¼‰ï¼Œå‡å°‘ä¸å¿…è¦çš„è‰²å½©å¹²æ‰°ï¼Œä¸“æ³¨å†…å®¹ç»“æ„ã€‚

### 1. Visual Aesthetics (è§†è§‰ç¾å­¦)

- **Color Palette**:
  - **Background**: Matte Charcoal `#1C1C1C` / `bg-background` (Subtle Grid)
  - **Glass Surface**: `bg-black/40` with `backdrop-blur-md` and fine `border-white/10`.
  - **Accents**: ä»…åœ¨äº¤äº’ç‚¹ï¼ˆå¦‚é€‰ä¸­ã€Hoverã€Focusï¼‰ä½¿ç”¨ç»†è…»çš„ Primary Blue æˆ– White Glowï¼Œé¿å…ä½¿ç”¨é«˜é¥±å’Œéœ“è™¹è‰²ã€‚
- **Typography**: Inter (System UI)ï¼Œé«˜å¯¹æ¯”åº¦ç™½å­— (`text-foreground`) vs ç°å­— (`text-muted-foreground`)ã€‚
- **Cards**: **Frosted Glass** è´¨æ„Ÿï¼Œæ·±è‰²åŠé€æ˜å¡«å…… + æç»†å¾®çš„ç™½è‰²æè¾¹ï¼ˆ10% opacityï¼‰+ æŸ”å’Œé˜´å½±ã€‚

### 2. Breadcrumb Navigation Bar (é¢åŒ…å±‘å¯¼èˆªæ )

> **Visual Target**: æ‚¬æµ®äºç”»å¸ƒå·¦ä¸Šè§’çš„ç²¾è‡´ç»ç’ƒèƒ¶å›Šã€‚

| å±æ€§ | è§„æ ¼ | è¯¦ç»†è¯´æ˜ |
|------|------|----------|
| **Container** | `flex` | é‡‡ç”¨ **Glassmorphic** é£æ ¼ï¼š`bg-black/30 backdrop-blur-md`ï¼Œ`border border-white/10`ï¼Œ`rounded-md` (8px)ã€‚å…·æœ‰æå…¶å¾®å¦™çš„å†…éƒ¨é«˜å…‰ã€‚ |
| **Position** | `fixed` | ç”»å¸ƒå·¦ä¸Šæ–¹ `top-4 left-4`ï¼ŒZè½´å±‚çº§é«˜äºç”»å¸ƒå†…å®¹ã€‚ |
| **Items** | Text | éå½“å‰é¡¹ï¼š`text-muted-foreground` (approx `#888`)ï¼ŒHover æ—¶å˜ä¸º `#AAA` å¹¶å¸¦æœ‰è½»å¾®èƒŒæ™¯è‰² `hover:bg-white/5`ã€‚ |
| **Current Item** | Active | å½“å‰æ‰€åœ¨å­å›¾åç§°ï¼š`text-white`ï¼Œ`font-medium`ï¼Œæ—  Hover èƒŒæ™¯ã€‚ |
| **Separator** | Icon | `> ` (Chevron) ä½¿ç”¨æç»†çº¿æ¡ï¼Œé€æ˜åº¦ `0.3`ã€‚ |
| **Motion** | Transition | è·¯å¾„å˜åŒ–æ—¶ï¼Œå†…å®¹è½»å¾® Slide + Fade åˆ‡æ¢ã€‚ |

#### ç»„ä»¶ä»£ç å‚è€ƒæ ·å¼

```tsx
const breadcrumbContainer = "flex items-center gap-1.5 px-4 py-2 bg-black/40 backdrop-blur-md border border-white/10 rounded-lg shadow-2xl shadow-black/20";
const breadcrumbItem = "text-sm text-zinc-500 hover:text-zinc-300 hover:bg-white/5 px-2 py-1 rounded-md transition-all duration-200 cursor-pointer";
const breadcrumbActive = "text-sm text-white font-medium px-2 py-1 cursor-default";
```

### 3. Drill-Down Interaction (äº¤äº’ç»†èŠ‚)

#### Context Menu (å³é”®èœå•)
- **Style**: æç®€æ·±è‰²æµ®å±‚ï¼Œ`bg-zinc-900/90 backdrop-blur-xl`ï¼Œ`border border-zinc-800`ã€‚
- **Action Item**: "Enter Subgraph" é€‰é¡¹hoveræ—¶å‘ˆç°é«˜äº®çŠ¶æ€ï¼ˆå¦‚æ·±è“/æ·±ç´«èƒŒæ™¯ï¼‰ï¼Œå›¾æ ‡é«˜äº®ã€‚
- **Position**: ç´§éšé¼ æ ‡ä½ç½®ï¼Œä½†åœ¨èŠ‚ç‚¹é™„è¿‘æ—¶å¸é™„å¯¹é½ã€‚

#### Transition Animation (è½¬åœºåŠ¨ç”»)
- **Enter**: 
  - ä¸»å›¾æ·¡å‡º (`opacity: 0`, `scale: 0.95`)
  - é¢åŒ…å±‘ Slide In (`translateY: -10px` -> `0`, `opacity: 0` -> `1`)
  - å­å›¾èŠ‚ç‚¹ Staggered Fade In (ä¾æ¬¡é”™è½æµ®ç°)
- **Exit**: 
  - ç‚¹å‡»é¢åŒ…å±‘è¿”å›æ—¶ï¼Œå½“å‰è§†å›¾å‘å³/ä¸‹é€€å‡ºï¼Œä¸Šä¸€çº§è§†å›¾åå‘è¿›å…¥ã€‚

### 4. Node Presentation in Subgraph (å­å›¾èŠ‚ç‚¹å‘ˆç°)
- **Focus Root**: å½“å‰å­å›¾çš„æ ¹èŠ‚ç‚¹åº”è§†è§‰å¢å¼ºï¼ˆå¦‚ï¼šç•¥å¤§çš„å°ºå¯¸ï¼Œæˆ–ç‰¹æ®Šçš„è¾¹æ¡†å…‰æ™•ï¼‰ï¼Œè¡¨æ˜å®ƒæ˜¯å½“å‰è§†å›¾çš„"Anchor"ã€‚
- **Connectors**: è¿æ¥çº¿ä½¿ç”¨å¹³æ»‘çš„è´å¡å°”æ›²çº¿ï¼Œé¢œè‰²ä¸ºæ·±ç° `stroke-zinc-700`ï¼Œä¸æŠ¢å èŠ‚ç‚¹æ³¨æ„åŠ›ã€‚

### 5. Motion & Accessibility
| åŠ¨ç”» | è§„æ ¼ | Reduced Motion |
|------|------|----------------|
| ä¸‹é’»åˆ‡æ¢ | `opacity`, `transform` 300ms cubic-bezier(0.2, 0, 0, 1) | ä»… Fade æ•ˆæœ |
| Hover Effects | 150ms ease-out | å–æ¶ˆä½ç§»ï¼Œä»…å˜è‰² |

---

## Tasks / Subtasks

> **å…³é”®å®ç°çº¦æŸ**ï¼šä¸‹é’»è·¯å¾„æ˜¯**çº¯æœ¬åœ°è§†å›¾çŠ¶æ€**ï¼Œä¸é€šè¿‡ Yjs åŒæ­¥ã€‚UI çŠ¶æ€å­˜å‚¨åœ¨ URL hash + sessionStorage ä»¥æ”¯æŒåˆ·æ–°æŒä¹…åŒ–ã€‚

### Phase 1: æ ¸å¿ƒæ•°æ®æ¨¡å‹ä¸çŠ¶æ€ç®¡ç† (AC: #1, #5)

- [x] Task 1.1: åˆ›å»ºä¸‹é’»çŠ¶æ€ Store
  - [x] 1.1.1 æ–°å»º `apps/web/lib/drillDownStore.ts`
  - [x] 1.1.2 å®šä¹‰ `DrillDownPath = string[]`ï¼ˆèŠ‚ç‚¹ ID è·¯å¾„ï¼‰
  - [x] 1.1.3 å®ç° `setDrillPath(path)` / `getDrillPath()` / `subscribe(listener)`
  - [x] 1.1.4 æ”¯æŒ `pushPath(nodeId)` / `popPath()` / `goToPath(path)`
  - [x] 1.1.5 ä½¿ç”¨ `useSyncExternalStore` åˆ›å»º `useDrillPath()` hook

- [x] Task 1.2: URL/SessionStorage æŒä¹…åŒ–
  - [x] 1.2.1 ä¸‹é’»è·¯å¾„åŒæ­¥åˆ° URL hashï¼ˆå¦‚ `#drill=nodeA/nodeB/nodeC`ï¼‰
  - [x] 1.2.2 é¡µé¢åŠ è½½æ—¶ä» URL æ¢å¤è·¯å¾„
  - [x] 1.2.3 å¤‡ç”¨ sessionStorage å­˜å‚¨ï¼ˆæ—  hash åœºæ™¯ï¼‰

### Phase 2: å­å›¾æ¸²æŸ“é€»è¾‘ (AC: #1, #6)

- [x] Task 2.1: GraphComponent é›†æˆ
  - [x] 2.1.1 åœ¨ `GraphComponent.tsx` ä¸­æ¶ˆè´¹ `useDrillPath()`
  - [x] 2.1.2 åŸºäº **X6 Graph** çš„å±‚çº§è¾¹ï¼ˆæ’é™¤ dependency edgesï¼‰è®¡ç®—â€œå¯è§å­æ ‘é›†åˆâ€ï¼ˆæ ¹èŠ‚ç‚¹ + æ‰€æœ‰åä»£ï¼‰
  - [x] 2.1.3 é€šè¿‡ `node.hide()/node.show()` + `edge.hide()/edge.show()` å®ç°è§†å›¾è¿‡æ»¤ï¼ˆåªæ”¹å¯è§æ€§ï¼Œ**ä¸ç§»é™¤ cells**ï¼‰
  - [x] 2.1.4 **ä¸ä¿®æ”¹ Yjs æ•°æ®**ï¼ˆä¸å†™å…¥ Yjsã€ä¸åˆ èŠ‚ç‚¹/è¾¹ï¼›ä¸‹é’»ä»…æ˜¯æœ¬åœ°è§†å›¾çŠ¶æ€ï¼‰

- [x] Task 2.2: ä¸‹é’»å…¥å£äº¤äº’
  - [x] 2.2.1 ä¿®æ”¹ `NodeContextMenu.tsx` æ·»åŠ "è¿›å…¥å­å›¾"èœå•é¡¹
    - æœ‰å­èŠ‚ç‚¹ï¼šæ˜¾ç¤ºå¯ç‚¹å‡»é€‰é¡¹
    - æ— å­èŠ‚ç‚¹ï¼šéšè—æˆ–ç¦ç”¨é€‰é¡¹
  - [x] 2.2.2 ä¿®æ”¹ `useGraphHotkeys` æ·»åŠ  `Cmd/Ctrl+Enter` ä¸‹é’»å¿«æ·é”®

### Phase 3: é¢åŒ…å±‘å¯¼èˆªç»„ä»¶ (AC: #2, #3)

- [x] Task 3.1: åˆ›å»º Breadcrumb ç»„ä»¶
  - [x] 3.1.1 æ–°å»º `apps/web/components/graph/parts/DrillBreadcrumb.tsx`
  - [x] 3.1.2 æ¶ˆè´¹ `useDrillPath()` è·å–å½“å‰è·¯å¾„
  - [x] 3.1.3 æ ¹æ®è·¯å¾„æŸ¥è¯¢èŠ‚ç‚¹æ ‡é¢˜ï¼ˆä» Yjs æˆ– storeï¼‰
  - [x] 3.1.4 æ¸²æŸ“é¢åŒ…å±‘é¡¹ï¼Œæ”¯æŒç‚¹å‡»å¯¼èˆª
  - [x] 3.1.5 ç‚¹å‡»çˆ¶å±‚çº§é¡¹è¿”å›å¯¹åº”å±‚çº§
  - [x] 3.1.6 ç‚¹å‡» Home å›¾æ ‡è¿”å›ä¸»å›¾
  - [x] 3.1.7 æº¢å‡ºå¤„ç†ï¼šè¶…è¿‡ 4 é¡¹æ—¶ä¸­é—´æŠ˜å ä¸º `...`

> âš¡ **è®¾è®¡å†³ç­–**ï¼šè¿”å›ä¸Šå±‚ä»…é€šè¿‡é¢åŒ…å±‘å¯¼èˆªï¼Œæ— ä¸“ç”¨å¿«æ·é”®ã€‚è¿™ç®€åŒ–äº†ä¸ç°æœ‰ Escape é”®é€»è¾‘çš„å†²çªï¼Œå¹¶æä¾›æ›´ç›´è§‚çš„å¯¼èˆªä½“éªŒã€‚

### Phase 4: è¿‡æ¸¡åŠ¨ç”»ä¸è§†è§‰åé¦ˆ (AC: #1, #2)

- [x] Task 4.1: ä¸‹é’»/è¿”å›åŠ¨ç”»
  - [x] 4.1.1 å®ç° CSS transition åŠ¨ç”»ï¼ˆopacity + scaleï¼‰
  - [x] 4.1.2 ä½¿ç”¨ `motion-reduce:*` éµå®ˆç”¨æˆ·åå¥½
  - [x] 4.1.3 æ·»åŠ ä¸‹é’»æŒ‡ç¤ºå™¨å›¾æ ‡åˆ°æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹

### Phase 5: æµ‹è¯• (All ACs)

- [x] Task 5.1: å•å…ƒæµ‹è¯• (Vitest)
- [x] Task 5.2: ç»„ä»¶æµ‹è¯• (Vitest + RTL)
- [x] Task 5.3: E2E æµ‹è¯• (Playwright)

### Review Follow-ups (AI)

- [x] [AI-Review][CRITICAL] å·²ä¿®å¤ï¼šé¢åŒ…å±‘â€œ>4 æŠ˜å ä¸º `...`â€ [apps/web/components/graph/parts/DrillBreadcrumb.tsx:85]
- [x] [AI-Review][CRITICAL] å·²ä¿®å¤ï¼š`prefers-reduced-motion` æ”¯æŒï¼ˆé¢åŒ…å±‘ fade-onlyï¼›ä¸‹é’»åˆ‡æ¢ç¦ç”¨ zoomï¼‰ [apps/web/components/graph/parts/DrillBreadcrumb.tsx:108] [apps/web/components/graph/GraphComponent.tsx:300]
- [x] [AI-Review][CRITICAL] å·²è¡¥é½ï¼šPlaywright E2Eï¼ˆ`apps/web/e2e/drill-down.spec.ts`ï¼‰ [apps/web/e2e/drill-down.spec.ts:1]
- [x] [AI-Review][CRITICAL] å·²ä¿®å¤ï¼š`Cmd/Ctrl+Enter` ä¸å¯ä¸‹é’»æ—¶ NO-OP ä¸”ä¸è½å…¥ Enter åˆ›å»ºèŠ‚ç‚¹é€»è¾‘ [apps/web/components/graph/hooks/useGraphHotkeys.ts:285]
- [x] [AI-Review][HIGH] å·²ä¿®å¤ï¼šé€€å‡ºä¸‹é’»åä¿ç•™æŠ˜å éšè—ï¼ˆä¸»è§†å›¾å¯è§æ€§ä¸ collapse å…¼å®¹ï¼‰ [apps/web/components/graph/hooks/useDrillDown.ts:286]
- [x] [AI-Review][HIGH] å·²ä¿®å¤ï¼šè¿‡æ»¤é€»è¾‘æ‰¹é‡æ›´æ–° + å–æ¶ˆç«æ€ï¼ˆ`graph.batchUpdate` + rAFï¼›ç§»é™¤ `setTimeout`ï¼‰ [apps/web/components/graph/hooks/useDrillDown.ts:242]
- [x] [AI-Review][MEDIUM] å·²ä¿®å¤ï¼šæ–‡æ¡£ä¸å®ç°æ¼‚ç§»ï¼ˆBreadcrumb å‘½åã€æµ‹è¯•è·¯å¾„ã€API åç§°ï¼‰ [docs/sprint-artifacts/story-8-9-subgraph-drill-down.md:163]
- [x] [AI-Review][LOW] å·²ä¿®å¤ï¼šä»£ç å«ç”Ÿï¼ˆç§»é™¤æœªä½¿ç”¨å¯¼å…¥ï¼‰ [apps/web/components/graph/hooks/useDrillDown.ts:13]

---

## Dev Notes

### ğŸ›¡ï¸ å·¥ç¨‹è§„èŒƒæŠ¤æ  (Engineering Guardrails)

#### GR-1: Hook-First æ¨¡å¼ ğŸ”´ å¼ºåˆ¶
æ‰€æœ‰ä¸‹é’»é€»è¾‘å°è£…åœ¨ `useDrillPath` hook ä¸­ã€‚

#### GR-2: æ–‡ä»¶å¤§å°é™åˆ¶ (300 è¡Œ) ğŸ”´ å¼ºåˆ¶
æ–°ç»„ä»¶ï¼ˆBreadcrumbï¼‰å’Œ store å„è‡ªä¸è¶…è¿‡ 300 è¡Œã€‚

#### GR-3: Yjs-First æ•°æ®æµ ğŸ”´ å¼ºåˆ¶
**ä¸‹é’»è·¯å¾„æ˜¯è§†å›¾çŠ¶æ€ï¼Œä¸æ˜¯æ•°æ®**ã€‚ä¸ä¿®æ”¹ Yjs ä¸­çš„èŠ‚ç‚¹ç»“æ„ï¼Œä»…åœ¨æ¸²æŸ“å±‚è¿‡æ»¤ã€‚
ä¸ä½¿ç”¨ Yjs Awareness åŒæ­¥ä¸‹é’»è·¯å¾„ï¼ˆçº¯æœ¬åœ°è§†å›¾çŠ¶æ€ï¼‰ã€‚

> ğŸ“– **æ¶æ„å¼•ç”¨**: `architecture.md:546-549` - UI ä¸èƒ½ç›´æ¥ä¿®æ”¹æœ¬åœ°çŠ¶æ€ï¼Œéœ€é€šè¿‡ Yjs æ‰§è¡Œå†™æ“ä½œã€‚ä¸‹é’»è·¯å¾„å±äºè§†å›¾çŠ¶æ€ï¼Œä¸å±äºæ•°æ®å±‚ã€‚

#### GR-3.1: è§†å›¾è¿‡æ»¤å®‰å…¨æ€§ ğŸ”´ å¼ºåˆ¶
**ç¦æ­¢**ç”¨ `graph.removeNode/removeEdge` å®ç°â€œåªæ¸²æŸ“å­æ ‘â€ã€‚åªèƒ½ä½¿ç”¨ `hide()/show()`ï¼ˆæˆ–ç­‰ä»·çš„å¯è§æ€§åˆ‡æ¢ï¼‰ã€‚  
åŸå› ï¼šèŠ‚ç‚¹/è¾¹ç§»é™¤ä¼šè¢«åŒæ­¥å±‚æ•è·å¹¶å†™å…¥ Yjsï¼Œå¯¼è‡´åä½œåœºæ™¯ä¸‹çš„çœŸå®åˆ é™¤ã€‚

#### GR-3.2: URL Hash æŒä¹…åŒ–ä¸ç ´åæŸ¥è¯¢å‚æ•° ğŸ”´ å¼ºåˆ¶
æ›´æ–° `#drill=...` æ—¶å¿…é¡»ä¿ç•™ `window.location.pathname + window.location.search`ï¼ˆä¾‹å¦‚ `?userId=`ï¼‰ï¼Œç¦æ­¢ç”¨ä»… `pathname` çš„ replaceStateã€‚

#### GR-4: è¿‡æ¸¡åŠ¨ç”»éµå®ˆ prefers-reduced-motion ğŸ”´ å¼ºåˆ¶
æ‰€æœ‰åŠ¨ç”»æ£€æŸ¥ç”¨æˆ·åå¥½ã€‚

> ğŸ“– **å·¥ç¨‹è§„èŒƒå¼•ç”¨**: `project-context.md:93` - æ–‡ä»¶å¤§å°é™åˆ¶ 300 è¡Œï¼›`project-context.md:84-86` - Hook-First å°è£…ã€‚

---

### ğŸ’¡ æŠ€æœ¯å†³ç­– (Technical Decisions)

| å†³ç­– | è¯´æ˜ |
|------|------|
| TD-1 | ä¸‹é’»è·¯å¾„å­˜å‚¨åœ¨ URL hash + sessionStorageï¼Œä¸å†™å…¥ Yjs ä¸»æ–‡æ¡£ |
| TD-2 | **ä¸ä½¿ç”¨** Yjs Awareness åŒæ­¥ï¼ˆä¸‹é’»æ˜¯çº¯æœ¬åœ°è§†å›¾çŠ¶æ€ï¼‰ |
| TD-3 | å­å›¾æ¸²æŸ“é€šè¿‡è§†å›¾è¿‡æ»¤å®ç°ï¼Œä¸æ”¹å˜åº•å±‚æ•°æ®ç»“æ„ |
| TD-4 | é¢åŒ…å±‘ç»„ä»¶ä½äº `GraphComponent` å¤–éƒ¨ï¼Œé€šè¿‡ store é€šä¿¡ |
| TD-5 | åŒå‡»ä¿æŒç¼–è¾‘æ¨¡å¼ï¼Œä¸‹é’»ä»…é€šè¿‡å³é”®èœå•æˆ– `Cmd/Ctrl+Enter` |
| TD-6 | è¿”å›ä¸Šå±‚ä»…é€šè¿‡é¢åŒ…å±‘å¯¼èˆªï¼Œæ— ä¸“ç”¨å¿«æ·é”® |

---

### ğŸ“ é¡¹ç›®ç»“æ„è½ç‚¹

| æ–‡ä»¶ | ç±»å‹ | æè¿° |
|------|------|------|
| `apps/web/lib/drillDownStore.ts` | [NEW] | ä¸‹é’»è·¯å¾„çŠ¶æ€ store + hooks |
| `apps/web/components/graph/parts/DrillBreadcrumb.tsx` | [NEW] | é¢åŒ…å±‘å¯¼èˆªç»„ä»¶ï¼ˆå«è¿”å›åŠŸèƒ½ï¼‰ |
| `apps/web/components/graph/GraphComponent.tsx` | [MODIFY] | é›†æˆä¸‹é’»è¿‡æ»¤é€»è¾‘ |
| `apps/web/components/graph/parts/NodeContextMenu.tsx` | [MODIFY] | æ·»åŠ "è¿›å…¥å­å›¾"èœå•é¡¹ |
| `apps/web/components/graph/hooks/useGraphHotkeys.ts` | [MODIFY] | æ·»åŠ  `Cmd/Ctrl+Enter` ä¸‹é’»å¿«æ·é”® |
| `apps/web/e2e/drill-down.spec.ts` | [NEW] | E2E æµ‹è¯• |
| `apps/web/lib/__tests__/drillDownStore.test.ts` | [NEW] | å•å…ƒæµ‹è¯• |

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥ (Testing Strategy)

> **ç›®æ ‡è¦†ç›–ç‡**: 100% AC åœºæ™¯ + è¾¹ç•Œæ¡ä»¶ + å®¹é”™å¤„ç†

### æµ‹è¯•è¦†ç›–çŸ©é˜µ

| AC | æè¿° | å•å…ƒæµ‹è¯• | ç»„ä»¶æµ‹è¯• | E2E æµ‹è¯• | è¾¹ç•Œæµ‹è¯• |
|----|------|:--------:|:--------:|:--------:|:--------:|
| AC1 | å³é”®èœå•/å¿«æ·é”®è¿›å…¥å­å›¾ | âœ… 4 | âœ… 2 | âœ… 4 | âœ… 2 |
| AC2 | é¢åŒ…å±‘å¯¼èˆªæ˜¾ç¤ºä¸äº¤äº’ | âœ… 2 | âœ… 4 | âœ… 3 | âœ… 2 |
| AC3 | é€šè¿‡é¢åŒ…å±‘è¿”å›ä¸Šå±‚ | âœ… 2 | âœ… 2 | âœ… 2 | âœ… 1 |
| AC4 | å­å›¾æ•°æ®å˜æ›´è‡ªåŠ¨åŒæ­¥ | âœ… 1 | âœ… 1 | âœ… 2 | âœ… 1 |
| AC5 | ä¸‹é’»çŠ¶æ€æŒä¹…åŒ– | âœ… 4 | âœ… 1 | âœ… 3 | âœ… 2 |
| AC6 | å¶å­èŠ‚ç‚¹ä¸å¯ä¸‹é’» | âœ… 1 | âœ… 1 | âœ… 2 | âœ… 1 |

**æ€»è®¡**: å•å…ƒ 14 + ç»„ä»¶ 11 + E2E 16 + è¾¹ç•Œ 9 = **50 ä¸ªæµ‹è¯•ç”¨ä¾‹**

---

### å•å…ƒæµ‹è¯• (Vitest)

**æ–‡ä»¶**: `apps/web/lib/__tests__/drillDownStore.test.ts`

#### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|--------|:------:|
| `pushPath` æ·»åŠ èŠ‚ç‚¹åˆ°è·¯å¾„ | AC1 | P0 |
| `pushPath` å¤šå±‚è¿ç»­ä¸‹é’» | AC1 | P1 |
| `popPath` è¿”å›ä¸Šä¸€å±‚ | AC3 | P0 |
| `popPath` ç©ºè·¯å¾„è¿”å› false | AC3 | P1 |
| `goToPath` ç›´æ¥è·³è½¬åˆ°æŒ‡å®šè·¯å¾„ | AC2 | P0 |
| `goToPath` è·¨å±‚çº§è·³è½¬ï¼ˆlevel 3 â†’ level 1ï¼‰ | AC2 | P1 |
| `resetPath` æ¸…ç©ºæ‰€æœ‰å±‚çº§ | AC3 | P1 |
| `getDrillPath` è¿”å›å½“å‰è·¯å¾„å¿«ç…§ï¼ˆç¨³å®šå¼•ç”¨ï¼‰ | AC1 | P1 |

#### æŒä¹…åŒ–æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|--------|:------:|
| URL hash åŒæ­¥ (`#drill=a/b/c`) | AC5 | P0 |
| `restoreFromUrl` ä» URL hash æ¢å¤ | AC5 | P0 |
| `restoreFromUrl` sessionStorage fallback | AC5 | P0 |
| URL ç‰¹æ®Šå­—ç¬¦ç¼–ç ï¼ˆnodeId åŒ…å« `/`ã€`#`ï¼‰ | AC5 | P1 |

#### è®¢é˜…ä¸é€šçŸ¥æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|--------|:------:|
| `subscribe` å¤šè®¢é˜…è€…é€šçŸ¥ | AC4 | P1 |
| å–æ¶ˆè®¢é˜…åä¸å†é€šçŸ¥ | AC4 | P2 |

---

### ç»„ä»¶æµ‹è¯• (Vitest + React Testing Library)

**æ–‡ä»¶**: `apps/web/__tests__/components/DrillBreadcrumb.test.tsx`

#### Breadcrumb ç»„ä»¶

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|--------|:------:|
| ç©ºè·¯å¾„ä¸æ¸²æŸ“ä»»ä½•å†…å®¹ | AC2 | P0 |
| æ¸²æŸ“æ­£ç¡®çš„è·¯å¾„å±‚çº§ | AC2 | P0 |
| å½“å‰é¡¹ï¼ˆæœ€åä¸€é¡¹ï¼‰æ˜¾ç¤ºä¸ºç¦ç”¨/ä¸å¯ç‚¹å‡» | AC2 | P1 |
| æº¢å‡ºå¤„ç†ï¼šè¶…è¿‡ 4 é¡¹æ—¶æŠ˜å ä¸º `...` | AC2 | P1 |
| Hover æ˜¾ç¤ºå®Œæ•´æ ‡é¢˜ tooltip | AC2 | P2 |
| ç‚¹å‡»çˆ¶å±‚çº§é¡¹è°ƒç”¨ `goToPath` | AC3 | P0 |
| ç‚¹å‡» Home å›¾æ ‡è°ƒç”¨ `resetPath` | AC3 | P0 |

#### èœå•é¡¹ç»„ä»¶

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|--------|:------:|
| æœ‰å­èŠ‚ç‚¹æ—¶æ˜¾ç¤º "è¿›å…¥å­å›¾" é€‰é¡¹ | AC1, AC6 | P0 |
| æ— å­èŠ‚ç‚¹æ—¶éšè—/ç¦ç”¨ "è¿›å…¥å­å›¾" é€‰é¡¹ | AC6 | P0 |

#### åŠ¨ç”»ç»„ä»¶

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|--------|:------:|
| `prefers-reduced-motion` æ—¶ç¦ç”¨ scale åŠ¨ç”» | AC1 | P1 |
| æ­£å¸¸æ¨¡å¼ä¸‹åº”ç”¨ opacity + scale åŠ¨ç”» | AC1 | P2 |

---

### E2E æµ‹è¯• (Playwright)

**æ–‡ä»¶**: `apps/web/e2e/drill-down.spec.ts`

#### ä¸‹é’»å…¥å£æµ‹è¯• (AC1)

| æµ‹è¯•ç”¨ä¾‹ | ä¼˜å…ˆçº§ |
|----------|:------:|
| å³é”®æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ â†’ æ˜¾ç¤º "è¿›å…¥å­å›¾" èœå•é¡¹ | P0 |
| ç‚¹å‡» "è¿›å…¥å­å›¾" â†’ è§†å›¾åˆ‡æ¢ä¸ºå­å›¾ï¼Œåªæ˜¾ç¤ºåä»£èŠ‚ç‚¹ | P0 |
| `Cmd/Ctrl+Enter` å¿«æ·é”® â†’ è¿›å…¥é€‰ä¸­èŠ‚ç‚¹çš„å­å›¾è§†å›¾ | P0 |
| `Cmd/Ctrl+Enter` åœ¨å¶å­èŠ‚ç‚¹ä¸Š â†’ æ— æ•ˆæœï¼ˆä¸æŠ¥é”™ï¼‰ | P1 |

#### é¢åŒ…å±‘å¯¼èˆªæµ‹è¯• (AC2, AC3)

| æµ‹è¯•ç”¨ä¾‹ | ä¼˜å…ˆçº§ |
|----------|:------:|
| ä¸‹é’»åé¢åŒ…å±‘æ˜¾ç¤ºæ­£ç¡®è·¯å¾„ï¼ˆæ ¼å¼ï¼šHome â€º çˆ¶èŠ‚ç‚¹ â€º å½“å‰èŠ‚ç‚¹ï¼‰ | P0 |
| ç‚¹å‡»é¢åŒ…å±‘ä¸­é—´é¡¹ â†’ è·³è½¬åˆ°å¯¹åº”å±‚çº§ | P0 |
| ç‚¹å‡» Home å›¾æ ‡ â†’ è¿”å›ä¸»å›¾è§†å›¾ | P0 |
| å¤šå±‚ä¸‹é’»åï¼ˆA â†’ B â†’ Cï¼‰ï¼Œä» C ç›´æ¥è·³åˆ° A | P1 |
| æ·±å±‚è·¯å¾„ï¼ˆ>4é¡¹ï¼‰é¢åŒ…å±‘æŠ˜å ä¸º `...` | P1 |

#### æŒä¹…åŒ–æµ‹è¯• (AC5)

| æµ‹è¯•ç”¨ä¾‹ | ä¼˜å…ˆçº§ |
|----------|:------:|
| ä¸‹é’»ååˆ·æ–°é¡µé¢ â†’ æ¢å¤åˆ°åˆ·æ–°å‰çš„ä½ç½® | P0 |
| æ·±å±‚ä¸‹é’»ï¼ˆ3+ å±‚ï¼‰ååˆ·æ–° â†’ æ­£ç¡®æ¢å¤å®Œæ•´è·¯å¾„ | P1 |
| URL hash æ‰‹åŠ¨ä¿®æ”¹ååŠ è½½é¡µé¢ â†’ å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„ | P2 |

#### å¶å­èŠ‚ç‚¹æµ‹è¯• (AC6)

| æµ‹è¯•ç”¨ä¾‹ | ä¼˜å…ˆçº§ |
|----------|:------:|
| å³é”®å¶å­èŠ‚ç‚¹ â†’ ä¸æ˜¾ç¤º "è¿›å…¥å­å›¾" é€‰é¡¹ | P0 |
| åŒå‡»å¶å­èŠ‚ç‚¹ â†’ è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ˆä¿æŒç°æœ‰è¡Œä¸ºï¼‰ | P1 |

#### åä½œåŒæ­¥æµ‹è¯• (AC4) âš ï¸ éœ€åŒç”¨æˆ·ç¯å¢ƒ

| æµ‹è¯•ç”¨ä¾‹ | ä¼˜å…ˆçº§ |
|----------|:------:|
| ç”¨æˆ·Aåœ¨å­å›¾ä¸­æ·»åŠ èŠ‚ç‚¹ â†’ ç”¨æˆ·Båœ¨ä¸»å›¾å¯è§ | P0 |
| ç”¨æˆ·Aå’ŒBåœ¨ä¸åŒå­å›¾å±‚çº§ â†’ åŒæ–¹çœ‹åˆ°å„è‡ªè§†å›¾ï¼ˆdrillPath æœ¬åœ°éš”ç¦»ï¼‰ | P1 |

---

### è¾¹ç•Œæ¡ä»¶ä¸å®¹é”™æµ‹è¯•

#### è¾¹ç•Œåœºæ™¯

| æµ‹è¯•ç±»å‹ | æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|----------|--------|:------:|
| å•å…ƒ | ç©ºå›¾ï¼ˆæ— èŠ‚ç‚¹ï¼‰ä¸‹é’»å°è¯• | AC1 | P0 |
| å•å…ƒ | å•èŠ‚ç‚¹å›¾ï¼ˆä»…æ ¹èŠ‚ç‚¹ï¼‰ä¸‹é’»å°è¯• | AC6 | P1 |
| E2E | æ·±å±‚çº§ï¼ˆ10+ å±‚ï¼‰ä¸‹é’»æ€§èƒ½ | AC1 | P2 |
| E2E | è¶…é•¿èŠ‚ç‚¹æ ‡é¢˜ï¼ˆ100+ å­—ç¬¦ï¼‰é¢åŒ…å±‘æˆªæ–­ | AC2 | P2 |

#### å®¹é”™åœºæ™¯ ğŸ”´ å…³é”®

| æµ‹è¯•ç±»å‹ | æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– AC | ä¼˜å…ˆçº§ |
|----------|----------|--------|:------:|
| å•å…ƒ | `drillPath` ä¸­èŠ‚ç‚¹ ID ä¸å­˜åœ¨æ—¶çš„å¤„ç† | AC5 | P0 |
| E2E | ç”¨æˆ·åœ¨å­å›¾ä¸­æ—¶ï¼Œ**è¯¥èŠ‚ç‚¹è¢«åˆ é™¤** â†’ è‡ªåŠ¨å›é€€åˆ°ä¸»å›¾ | AC4 | **P0** |
| å•å…ƒ | URL hash æ ¼å¼é”™è¯¯æ—¶çš„ fallback | AC5 | P1 |
| E2E | æµè§ˆå™¨ Back/Forward æŒ‰é’®ä¸ URL hash äº¤äº’ | AC5 | P2 |

---

### å¯è®¿é—®æ€§æµ‹è¯• (Accessibility)

| æµ‹è¯•ç”¨ä¾‹ | è¦†ç›– | ä¼˜å…ˆçº§ |
|----------|------|:------:|
| é¢åŒ…å±‘æ”¯æŒé”®ç›˜ Tab å¯¼èˆª | WCAG 2.1 | P2 |
| ä¸‹é’»åç„¦ç‚¹ç®¡ç†ï¼ˆåº”èšç„¦åˆ°æ–°è§†å›¾ï¼‰ | WCAG 2.1 | P2 |
| Screen Reader å¯è¯»å–é¢åŒ…å±‘è·¯å¾„ | WCAG 2.1 | P3 |

---

### æµ‹è¯•è¿è¡Œå‘½ä»¤

```bash
# å•å…ƒæµ‹è¯• + ç»„ä»¶æµ‹è¯• (Vitest)
pnpm --filter @cdm/web test

# è¿è¡Œ drillDown ç›¸å…³æµ‹è¯•
pnpm --filter @cdm/web test drillDownStore
pnpm --filter @cdm/web test Breadcrumb

# E2E æµ‹è¯• (Playwright)
pnpm --filter @cdm/web test:e2e

# è¿è¡Œç‰¹å®š E2E æµ‹è¯•
pnpm --filter @cdm/web test:e2e drill-down

# åä½œåŒæ­¥æµ‹è¯•ï¼ˆéœ€åŒç”¨æˆ·ç¯å¢ƒï¼‰
pnpm --filter @cdm/web test:e2e drill-down --grep "collaboration"
```

---

### æµ‹è¯•æ•°æ®å‡†å¤‡

```typescript
// fixtures/drillDownTestData.ts
export const testGraph = {
  root: { id: 'root', label: 'æ ¹ä¸»é¢˜', children: ['a', 'b'] },
  a: { id: 'a', label: 'ç³»ç»Ÿè®¾è®¡', children: ['a1', 'a2'] },
  a1: { id: 'a1', label: 'åç«¯æ¶æ„', children: ['a1-1'] },
  a1-1: { id: 'a1-1', label: 'API è®¾è®¡', children: [] }, // å¶å­èŠ‚ç‚¹
  a2: { id: 'a2', label: 'å‰ç«¯æ¶æ„', children: [] }, // å¶å­èŠ‚ç‚¹
  b: { id: 'b', label: 'äº§å“è§„åˆ’', children: [] }, // å¶å­èŠ‚ç‚¹
};

// ç”¨äºæµ‹è¯•çš„æ·±å±‚è·¯å¾„
export const deepPath = ['root', 'a', 'a1', 'a1-1'];
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹ (Notes)

1. **âš¡ è§†å›¾è¿‡æ»¤ä¼˜å…ˆ**ï¼šä¸‹é’»æ˜¯"è§†å›¾"æ¦‚å¿µï¼Œä¸ä¿®æ”¹åº•å±‚ Yjs æ•°æ®ç»“æ„
2. **ğŸ“ åŒå‡»ä¿æŒç¼–è¾‘**ï¼šåŒå‡»èŠ‚ç‚¹å§‹ç»ˆè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¸è§¦å‘ä¸‹é’»ï¼ˆä¸ç°æœ‰è¡Œä¸ºä¸€è‡´ï¼‰
3. **ğŸ”— ä¸ Focus Mode åŒºåˆ«**ï¼šFocus Mode æ·¡åŒ–å…¶ä»–èŠ‚ç‚¹ï¼Œä¸‹é’»å®Œå…¨éšè—å…¶ä»–èŠ‚ç‚¹
4. **ğŸŒ URL Hash ç®¡ç†**ï¼šæ³¨æ„ä¸ç°æœ‰ URL å‚æ•°ï¼ˆå¦‚ `?id=`ï¼‰çš„å…¼å®¹
5. **è¿”å›æ–¹å¼**ï¼šä»…é€šè¿‡é¢åŒ…å±‘å¯¼èˆªè¿”å›ï¼Œæ— ä¸“ç”¨å¿«æ·é”®ï¼ˆç®€åŒ–ä¸ Escape é”®çš„å†²çªï¼‰

---

## ğŸ”— ç›¸å…³éœ€æ±‚è¿½æº¯

| æ¥æº | æè¿° |
|------|------|
| PRD R1 | èŠ‚ç‚¹ä¸‹é’»å­å›¾å¹¶å›é“¾ |
| PRD 10.ç”»å¸ƒäº¤äº’ | èŠ‚ç‚¹ä¸‹é’»å­å›¾ï¼ˆé¢åŒ…å±‘å›é€€ï¼‰ |
| Epic 8 | å¤§è§„æ¨¡å›¾è°±ä½“éªŒä¼˜åŒ– |
| FR1 | è„‘å›¾æ ¸å¿ƒäº¤äº’ï¼šèŠ‚ç‚¹ä¸‹é’»å›é“¾ |

---

## ğŸ“Š ä¸ç°æœ‰ Stories çš„å…³ç³»

| Story | å…³ç³» | è¯´æ˜ |
|-------|------|------|
| Story 8.1 æŠ˜å å±•å¼€ | äº’è¡¥ | æŠ˜å éšè—å­èŠ‚ç‚¹ä½†ä¸æ”¹å˜è§†å›¾å±‚çº§ |
| Story 8.5 Focus Mode | å¹¶å­˜ | Focus æ·¡åŒ–èŠ‚ç‚¹ï¼Œä¸‹é’»åˆ‡æ¢è§†å›¾ |
| Story 8.8 Semantic Zoom | å¹¶å­˜ | LOD æ§åˆ¶èŠ‚ç‚¹è¯¦ç»†ç¨‹åº¦ï¼Œä¸ä¸‹é’»æ— å†²çª |
| Story 5.3 è·¨å›¾å¼•ç”¨ | å»¶ä¼¸ | æœªæ¥å¯ä»å­å›¾å¼•ç”¨å…¶ä»–å›¾ |

---

## Dev Agent Record

### File List (Code Review Fixes)

| æ–‡ä»¶ | ç±»å‹ | æè¿° |
|------|------|------|
| `apps/web/components/graph/parts/DrillBreadcrumb.tsx` | [MODIFY] | é¢åŒ…å±‘æº¢å‡ºæŠ˜å ï¼ˆ`...`ï¼‰+ reduced-motion |
| `apps/web/components/graph/GraphComponent.tsx` | [MODIFY] | ä¸‹é’»åˆ‡æ¢è¿‡æ¸¡ï¼ˆéµå®ˆ reduced-motionï¼‰ |
| `apps/web/components/graph/hooks/useDrillDown.ts` | [MODIFY] | æ‰¹é‡å¯è§æ€§æ›´æ–° + ç«æ€æ§åˆ¶ + ä¸æŠ˜å å…¼å®¹ |
| `apps/web/components/graph/hooks/useGraphHotkeys.ts` | [MODIFY] | `Cmd/Ctrl+Enter` ä¸å¯ä¸‹é’»æ—¶ NO-OPï¼ˆä¸è½å…¥ Enter åˆ›å»ºï¼‰ |
| `apps/web/__tests__/components/DrillBreadcrumb.test.tsx` | [MODIFY] | è¦†ç›–æº¢å‡ºæŠ˜å æ–­è¨€ |
| `apps/web/__tests__/hooks/useDrillDown.test.ts` | [MODIFY] | é€‚é… `batchUpdate/on/off` mock |
| `apps/web/__tests__/hooks/useGraphHotkeys.test.ts` | [MODIFY] | æ–°å¢ hotkey ä¸è½å…¥åˆ›å»ºé€»è¾‘ç”¨ä¾‹ |
| `apps/web/e2e/drill-down.spec.ts` | [NEW] | Playwright E2Eï¼šä¸‹é’»/æŒä¹…åŒ–/è¿”å›ä¸»å›¾/å¶å­èŠ‚ç‚¹ |
| `docs/sprint-artifacts/story-8-9-subgraph-drill-down.md` | [MODIFY] | ä¿®å¤æ–‡æ¡£æ¼‚ç§» + è®°å½• Code Review fixes |
| `docs/sprint-artifacts/tech-spec-8-9-subgraph-drill-down.md` | [MODIFY] | ä¿®å¤æ–‡æ¡£æ¼‚ç§»ï¼ˆBreadcrumb å‘½å/æµ‹è¯•è·¯å¾„ï¼‰ |

### Change Log

- 2026-01-09: Code Reviewï¼ˆAIï¼‰â€” ä¿®å¤æº¢å‡ºæŠ˜å ã€reduced-motionã€hotkey è¯¯è§¦å‘ã€å¯è§æ€§è¿‡æ»¤æ€§èƒ½/ç«æ€ã€æŠ˜å å…¼å®¹ï¼›è¡¥é½ Playwright E2Eï¼›ä¿®æ­£æ–‡æ¡£æ¼‚ç§»ã€‚

## Senior Developer Review (AI)

### Review Summary

- âœ… Code Review å·²å®Œæˆï¼ˆ2026-01-09ï¼‰ï¼šå…³é”®é—®é¢˜å·²ä¿®å¤
- âœ… AC è¦†ç›–å®Œæ•´ï¼Œæµ‹è¯•ç­–ç•¥æ˜ç¡®
- âœ… æŠ€æœ¯å†³ç­–éµå¾ª Yjs-First åŸåˆ™ï¼ˆä¸‹é’»æ˜¯è§†å›¾çŠ¶æ€ï¼Œä¸ä¿®æ”¹æ•°æ®å±‚ï¼‰
- âœ… ä¸ç°æœ‰ Focus Mode / Collapse / åŒå‡»ç¼–è¾‘åŠŸèƒ½æ— å†²çª
- âœ… å¿«æ·é”®å†²çªå·²è¯†åˆ«å¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼š`Cmd/Ctrl+Enter` å¿…é¡»åœ¨ `useGraphHotkeys` ä¸­ä¼˜å…ˆæ‹¦æˆªï¼Œé¿å…è½å…¥ç°æœ‰ Enter åˆ›å»ºé€»è¾‘

### Architecture Compliance

| è§„èŒƒ | çŠ¶æ€ | å¼•ç”¨ |
|------|:----:|------|
| Hook-First å°è£… | âœ… | `project-context.md:84-86` |
| Yjs-First æ•°æ®æµ | âœ… | `architecture.md:546-549` |
| æ–‡ä»¶å¤§å°é™åˆ¶ (300è¡Œ) | âœ… | `project-context.md:93` |
| æ— ç›´æ¥ fetch è°ƒç”¨ | âœ… | `refactoring-proposal Â§1.2` |

### Notes

- âœ… Awareness åŒæ­¥å·²æ˜ç¡®æ’é™¤åœ¨æœ¬ Story èŒƒå›´å¤–
- âœ… è¿”å›å¿«æ·é”®å·²ç§»é™¤ï¼Œç®€åŒ–ä¸ç°æœ‰ Escape é€»è¾‘çš„å†²çª
- ğŸ’¡ å»ºè®®ï¼šæœªæ¥å¯è€ƒè™‘æ·»åŠ  Awareness åŒæ­¥ä½œä¸ºå¢å¼ºåŠŸèƒ½ï¼ˆæ˜¾ç¤ºåä½œè€…å½“å‰å±‚çº§ï¼‰

### Findings (2026-01-09)

> ç»“è®ºï¼šå‘ç° 8 ä¸ªé—®é¢˜ï¼ˆ4 CRITICAL / 2 HIGH / 1 MEDIUM / 1 LOWï¼‰ï¼Œå·²å…¨éƒ¨ä¿®å¤ï¼›æµ‹è¯•å·²è¡¥é½ã€‚

- [FIXED][CRITICAL] é¢åŒ…å±‘æº¢å‡ºæœªæŠ˜å ï¼ˆ>4ï¼‰ [apps/web/components/graph/parts/DrillBreadcrumb.tsx:85]
- [FIXED][CRITICAL] reduced-motion æœªè½å®ï¼ˆé¢åŒ…å±‘/ä¸‹é’»åˆ‡æ¢ï¼‰ [apps/web/components/graph/parts/DrillBreadcrumb.tsx:108] [apps/web/components/graph/GraphComponent.tsx:300]
- [FIXED][CRITICAL] Playwright E2E ç¼ºå¤± [apps/web/e2e/drill-down.spec.ts:1]
- [FIXED][CRITICAL] `Cmd/Ctrl+Enter` ä¸å¯ä¸‹é’»æ—¶è½å…¥ Enter åˆ›å»ºèŠ‚ç‚¹ [apps/web/components/graph/hooks/useGraphHotkeys.ts:285]
- [FIXED][HIGH] é€€å‡ºä¸‹é’»åè¦†ç›–æŠ˜å éšè—ï¼ˆå¯è§æ€§æ³„æ¼ï¼‰ [apps/web/components/graph/hooks/useDrillDown.ts:286]
- [FIXED][HIGH] å¯è§æ€§æ›´æ–°æœªæ‰¹é‡ + ä¸å¯å–æ¶ˆçš„è§†å£ setTimeoutï¼ˆæ€§èƒ½/ç«æ€ï¼‰ [apps/web/components/graph/hooks/useDrillDown.ts:242]
- [FIXED][MEDIUM] æ–‡æ¡£ä¸å®ç°æ¼‚ç§»ï¼ˆBreadcrumb å‘½å/æµ‹è¯•è·¯å¾„/API åç§°ï¼‰ [docs/sprint-artifacts/story-8-9-subgraph-drill-down.md:163]
- [FIXED][LOW] æœªä½¿ç”¨å¯¼å…¥æ¸…ç† [apps/web/components/graph/hooks/useDrillDown.ts:13]

### Tests Run

- `pnpm --filter @cdm/web test`
