# Story 7.9: ApprovalStatusPanel 重构 - 用户验收测试 (UAT)

## 测试信息

- **Story**: 7.9 - ApprovalStatusPanel 组件拆分
- **测试日期**: 2026-01-01
- **测试环境**: 本地开发环境
- **前置条件**: 
  - 应用已启动 (`pnpm dev`)
  - 已登录系统
  - 有可访问的图谱和任务节点

---

## 📋 测试前准备

### 1. 启动应用

```bash
cd /Users/enjoyjavapan163.com/Code/ALT/Prototype/CDM-17/CDM-17-ALL
pnpm dev
```

### 2. 准备测试数据

确保系统中有以下元素：
- [ ] 至少 2 个任务节点（一个有审批配置，一个无审批配置）
- [ ] 至少 2 个用户账号（用于测试 Assignee 和 Approver 角色）

---

## 🧪 测试用例

### TC-UAT-001: 未配置审批流程展示

**目的**: 验证未配置审批流程时的 UI 展示正确

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 选中一个**没有配置审批流程**的任务节点 | 右侧属性面板显示 | | |
| 2 | 找到「审批流程」区域 | 显示「此任务未配置审批流程」提示 | | |
| 3 | 查看按钮 | 显示「配置流程」按钮（标题栏）和「配置审批流程」按钮（主区域） | | |
| 4 | 点击「配置流程」或「配置审批流程」按钮 | 打开 WorkflowConfigDialog 配置弹窗 | | |
| 5 | 关闭弹窗（不保存） | 弹窗关闭，返回原界面 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-002: 配置审批流程

**目的**: 验证配置审批流程功能正常

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 在未配置审批的任务上点击「配置审批流程」 | 打开配置弹窗 | | |
| 2 | 添加审批步骤（至少 2 步），指定审批人 | 步骤成功添加 | | |
| 3 | 点击保存/确认按钮 | 弹窗关闭 | | |
| 4 | 查看审批流程区域 | 显示已配置的步骤，状态徽章显示「待提交」 | | |
| 5 | 验证步骤展示 | 每个步骤显示名称和审批人（头像+ID） | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-003: 状态徽章展示

**目的**: 验证各状态下徽章显示正确

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 查看已配置但未提交的任务 | 状态徽章显示「待提交」(蓝色/info) | | |
| 2 | 提交审批后查看 | 状态徽章显示「待审批」(黄色/warning) | | |
| 3 | 审批通过后查看 | 状态徽章显示「已通过」(绿色/success) | | |
| 4 | 审批驳回后查看 | 状态徽章显示「已驳回」(红色/destructive) | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-004: 交付物上传

**目的**: 验证交付物上传功能正常（AC#4）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 以 **Assignee** 身份选中任务 | 交付物区域显示「上传」按钮 | | |
| 2 | 点击「上传」按钮 | 打开文件选择对话框 | | |
| 3 | 选择一个 PDF 文件 | 上传开始，按钮显示 loading spinner | | |
| 4 | 等待上传完成 | 文件出现在交付物列表中，显示文件名和图标 | | |
| 5 | 上传更多文件（如 .json, .png） | 每个文件都正确显示在列表中 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-005: 交付物预览

**目的**: 验证交付物预览功能正常（AC#4）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 鼠标悬停在交付物项上 | 显示操作按钮（预览/下载/删除） | | |
| 2 | 点击「预览」按钮（眼睛图标） | 打开预览模态框 | | |
| 3 | 查看模态框内容 | 显示文件名、上传时间、预览内容（mock）| | |
| 4 | 查看底部提示 | 显示「此为模拟预览，实际内容将由后端服务提供」 | | |
| 5 | 点击「关闭」按钮 | 模态框关闭 | | |
| 6 | 预览 JSON 文件 | 显示 JSON 格式的 mock 内容 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-006: 交付物下载

**目的**: 验证交付物下载功能正常（AC#4）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 悬停在交付物项上 | 显示下载按钮 | | |
| 2 | 点击「下载」按钮 | 新标签页打开或开始下载 | | |
| 3 | 在预览模态框中点击「下载」按钮 | 同样触发下载 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-007: 交付物删除（权限控制）

**目的**: 验证交付物删除功能及权限控制（AC#4）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 以 **Assignee** 身份悬停在交付物上 | 显示删除按钮（垃圾桶图标） | | |
| 2 | 点击「删除」按钮 | 交付物从列表中移除 | | |
| 3 | 以 **非 Assignee** 身份查看同一任务 | **不显示**删除按钮 | | |
| 4 | 审批通过后查看 | **不显示**上传按钮和删除按钮（禁止编辑） | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-008: 提交审批

**目的**: 验证提交审批功能正常（AC#5）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 以 **Assignee** 身份选中已配置审批的任务 | 显示审批流程区域 | | |
| 2 | 确保**无交付物** | 不显示「提交审批」按钮 | | |
| 3 | 上传至少一个交付物 | 显示「提交审批」按钮 | | |
| 4 | 点击「提交审批」按钮 | 按钮显示 loading，提交成功后状态变为「待审批」 | | |
| 5 | 查看步骤展示 | 当前审批步骤显示为蓝色脉冲动画 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-009: 审批通过

**目的**: 验证审批通过功能正常（AC#5）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 切换到 **Approver** 账号 | - | | |
| 2 | 选中待审批的任务 | 显示「通过」和「驳回」按钮 | | |
| 3 | 点击「通过」按钮 | 按钮显示 loading | | |
| 4 | 等待完成 | 当前步骤变为绿色勾选，进入下一步或显示「已通过」 | | |
| 5 | 查看步骤连接线 | 已通过的步骤之间显示绿色连接线 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-010: 审批驳回

**目的**: 验证审批驳回功能正常（AC#5）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 选中待审批的任务（以 Approver 身份） | 显示「通过」和「驳回」按钮 | | |
| 2 | 点击「驳回」按钮 | 显示驳回原因表单（红色背景） | | |
| 3 | 不填写原因，查看「确认驳回」按钮 | 按钮处于**禁用**状态 | | |
| 4 | 填写驳回原因（如：「设计需要调整」） | 「确认驳回」按钮变为可点击 | | |
| 5 | 点击「确认驳回」按钮 | 提交成功，状态变为「已驳回」 | | |
| 6 | 查看步骤展示 | 被驳回的步骤显示红色图标，显示「驳回原因: xxx」 | | |
| 7 | 点击「取消」按钮（另一个任务） | 驳回表单隐藏 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-011: 审批历史展示

**目的**: 验证审批步骤和历史信息展示正确（AC#3）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 选中一个已完成部分审批的任务 | 显示审批步骤列表 | | |
| 2 | 查看已通过的步骤 | 绿色勾选图标，步骤名称为绿色 | | |
| 3 | 查看已通过步骤的详情 | 显示审批人头像+ID，显示完成时间 | | |
| 4 | 查看被驳回的步骤 | 红色叉号图标，步骤名称为红色 | | |
| 5 | 查看驳回步骤的详情 | 显示「驳回原因: xxx」 | | |
| 6 | 查看待处理的步骤 | 蓝色时钟图标（带脉冲动画），步骤名称为蓝色 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-012: 按钮禁用条件

**目的**: 验证各按钮在不同状态下的禁用逻辑正确

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 非 Assignee 查看未提交任务 | 不显示「提交审批」按钮 | | |
| 2 | 非 Approver 查看待审批任务 | 不显示「通过/驳回」按钮 | | |
| 3 | 查看已通过的任务 | 不显示任何操作按钮 | | |
| 4 | 操作进行中（loading） | 所有按钮禁用 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-013: 状态消息展示

**目的**: 验证最终状态消息显示正确

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 查看「已通过」的任务 | 底部显示绿色文字「审批已通过」（带勾选图标） | | |
| 2 | 查看「已驳回」的任务 | 底部显示红色文字「审批已驳回」（带叉号图标） | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-014: UI 样式一致性

**目的**: 验证重构后 UI 样式与之前一致（纯重构）

| 步骤 | 操作 | 预期结果 | 实际结果 | 通过? |
|------|------|----------|----------|-------|
| 1 | 检查整体布局 | 审批流程面板样式正常（圆角、边框、阴影） | | |
| 2 | 检查步骤图标大小 | 圆形图标 h-8 w-8，头像 h-5 w-5 | | |
| 3 | 检查按钮样式 | Button 组件样式正常，颜色正确 | | |
| 4 | 检查徽章样式 | Badge 组件样式正常，variant 颜色正确 | | |
| 5 | 检查交付物列表 | 悬停时显示操作按钮，过渡动画平滑 | | |
| 6 | 检查预览模态框 | 半透明遮罩，圆角弹窗，关闭按钮正常 | | |

**测试结果**: □ 通过 □ 失败

---

### TC-UAT-015: 代码质量验证

**目的**: 验证重构符合技术要求（AC#1, AC#6）

| 检查项 | 命令 / 方法 | 预期结果 | 实际结果 | 通过? |
|--------|-------------|----------|----------|-------|
| 主文件行数 | `wc -l apps/web/components/PropertyPanel/ApprovalStatusPanel.tsx` | < 300 行 | | |
| 新组件创建 | 检查文件存在 | 5 个新组件文件已创建 | | |
| 类型检查 | `pnpm --filter @cdm/web typecheck` | 无类型错误 | | |
| Lint 检查 | `pnpm --filter @cdm/web lint` | 无 lint 错误 | | |
| 单元测试 | `pnpm --filter @cdm/web test` | 所有测试通过 | | |

**测试结果**: □ 通过 □ 失败

---

## 📊 测试总结

| 测试用例 | 结果 |
|----------|------|
| TC-UAT-001: 未配置审批流程展示 | □ 通过 □ 失败 |
| TC-UAT-002: 配置审批流程 | □ 通过 □ 失败 |
| TC-UAT-003: 状态徽章展示 | □ 通过 □ 失败 |
| TC-UAT-004: 交付物上传 | □ 通过 □ 失败 |
| TC-UAT-005: 交付物预览 | □ 通过 □ 失败 |
| TC-UAT-006: 交付物下载 | □ 通过 □ 失败 |
| TC-UAT-007: 交付物删除（权限控制） | □ 通过 □ 失败 |
| TC-UAT-008: 提交审批 | □ 通过 □ 失败 |
| TC-UAT-009: 审批通过 | □ 通过 □ 失败 |
| TC-UAT-010: 审批驳回 | □ 通过 □ 失败 |
| TC-UAT-011: 审批历史展示 | □ 通过 □ 失败 |
| TC-UAT-012: 按钮禁用条件 | □ 通过 □ 失败 |
| TC-UAT-013: 状态消息展示 | □ 通过 □ 失败 |
| TC-UAT-014: UI 样式一致性 | □ 通过 □ 失败 |
| TC-UAT-015: 代码质量验证 | □ 通过 □ 失败 |

**总计**: __ / 15 通过

---

## ✅ 验收标准确认

根据 Story 7.9 Acceptance Criteria：

| AC# | 描述 | 验收状态 |
|-----|------|----------|
| AC#1 | 主文件行数降低至 300 行以内 | □ 通过 |
| AC#2 | 分离为 ApprovalStatus.tsx 和 ApprovalActions.tsx | □ 通过 |
| AC#3 | 创建 ApprovalHistory.tsx 组件 | □ 通过 |
| AC#4 | 创建 DeliverablesSection.tsx，保持所有能力 | □ 通过 |
| AC#5 | 所有交互与展示保持正常 | □ 通过 |
| AC#6 | 满足 Hook-First 约束 | □ 通过 |

---

## 📝 备注

测试人员: _____________

测试日期: 2026-01-01

签字确认: _____________
