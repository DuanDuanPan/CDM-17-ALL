# 复盘：Epic 2 - 任务与视图管理

**日期**：2025-12-23  
**参与人**：Enjoyjavapan（Project Lead）、Bob（Scrum Master）、Alice（Product Owner）、Charlie（Senior Dev）、Dana（QA Engineer）、Elena（Dev）  
**状态**：完成  

---

## 1. 执行概览（Summary & Metrics）
- **故事完成**：9/9（100%）
- **高优问题**：约 3–4 个（含接近回滚的质量事件）
- **测试现状**：手动测试通过；自动化用例与真实行为存在偏差风险
- **部署**：未部署（不作为 Epic 4 阻塞项）
- **干系人验收**：已确认，无需处理

---

## 2. 成功与优势（What Went Well）
- **设计清晰 + 测试前置显著提高交付质量**：2.3（多视图联动）与 2.5（搜索/归档）作为样板，明确的数据投影原则与测试清单减少了返工。
- **复用模式成型**：命令面板/搜索对话框、属性面板 Registry、投影架构等模式在多故事复用，降低实现不确定性。
- **评审修复机制有效**：对抗性评审与快速修复形成稳定的质量纠偏节奏。

---

## 3. 挑战与问题（What Didn’t Go Well）
- **复杂度上升导致回归风险放大**：改动一个点容易破坏既有功能。
- **逻辑缺陷发现偏晚**：实现后才暴露问题，二次调整成本高。
- **规范未形成硬门槛**：技术规范与 UI 规范未被视为强制闸门。
- **同步链路与交互耦合**：修复交互导致多端同步问题（例如 APP 节点修复空格编辑后出现同步回归）。
- **典型回归**：知识绑定/解绑后 UI 未正确更新。
- **Mock 与真实集成反复踩坑**：环境变量、路由前缀、WS 连接策略不统一。
- **测试与实现未同步**：用例不够精准且未随变更更新，导致“测过但现实不对”。
- **文档/状态漂移**：Story 状态、sprint-status、tech-spec 不一致。

---

## 4. 根因分析（Root Causes）
**核心根因：**
1) **规范执行缺少硬门槛**（Spec Gate 未成为开工条件）。  
2) **测试用例与实现变更不同步**（回归用例未形成强约束）。  

**助推因素：**
- Yjs 同步链路复杂且缺少最小稳定保护套件。
- Mock → Real 集成缺少统一策略。

---

## 5. 上一轮行动项跟进（Epic 1 → Epic 2）
- **AI-1 严格详细设计先行**：✅ 已落实（2.3/2.5 的设计产物与执行成效显著）。
- **AI-2 UI 自检与差距分析**：⏳ 部分落实（规范存在，但未成为硬门槛）。
- **AI-3 测试前置**：✅ 已落实（多数故事在设计阶段定义测试）。

---

## 6. 关键洞察（Key Insights）
- **规范与测试必须是“硬门槛”**，否则复杂度上升会放大回归风险。
- **Mock → Real 集成与同步链路是高频故障点**，需要前移验证与统一策略。
- **调试痛苦是系统性信号**，必须通过契约与回归保护来降低不确定性。

---

## 7. 下一 Epic 预览（Epic 4：流程编排与沟通）
**目标范围**：审批驱动执行编排、智能通知节流、上下文评论与 @提及、关注订阅机制。  
**主要依赖**：
- 2.1/2.2 的任务映射与依赖关系
- 2.4 的通知模块与分发机制
- 2.5 的标签/搜索/归档作为评论与订阅的过滤基础

**最大担忧**：审批状态机不清晰导致流程卡死。  
**决策**：采用 **标准 BPMN 状态机**。通知节流规则暂不细化。

---

## 8. 行动项（Action Items）

### Process Improvements
1) **规范硬门槛（Tech/UI Spec Gate）**  
- Owner：Bob + Charlie  
- 关口：Story 4.1 开发前  
- 成功标准：每个 Story 开工前必须具备“技术规范 + UI 规范 + 状态机 + 测试清单”。

2) **测试用例与实现变更强绑定（Test Sync Rule）**  
- Owner：Dana  
- 关口：进入 Review 前  
- 成功标准：任何行为变更必须同步更新对应测试，PR 中体现变更。

3) **关键交互回归清单（Regression Smoke List）**  
- Owner：Dana + Charlie  
- 关口：Story 4.1 开发前  
- 成功标准：至少覆盖“空格编辑、知识绑定/解绑 UI 更新、多端同步、审批/通知基础流”。

### Technical Debt
4) **多端同步回归保护（High）**  
- Owner：Charlie  
- 成功标准：关键同步链路与字段完整性有最小稳定套件覆盖。

5) **Mock → Real 集成标准化（Medium）**  
- Owner：Charlie  
- 成功标准：API base/WS/rewrites/env 统一策略落地。

### Documentation
6) **状态与文档对齐规约**  
- Owner：Bob  
- 关口：每次 Story 结束同步

7) **Epic 4 BPMN 状态机文档**  
- Owner：Alice + Charlie  
- 关口：Epic 4 实施前

### Team Agreements
- 不通过 Spec Gate 不开工  
- 行为变更必须同步更新测试  
- 影响多端同步的改动必须双端验证  
- **回归清单作为硬门槛贯穿 Epic 4（用户确认）**

---

## 9. Epic 4 准备任务

**CRITICAL（开工前必须完成）**
- **BPMN 审批状态机 + 状态映射表**（审批 ↔ 任务 ↔ assignment）
- **回归清单落地并可执行**（审批/评论/@/订阅 + 多端同步关键路径）

**PARALLEL（可并行）**
- 审批/评论/@/订阅事件契约（字段、触发条件、权限边界）
- data-testid 与选择器规范化
- Mock → Real 集成策略

**NICE-TO-HAVE**
- 通知节流细化规则
- 性能/稳定性基线补测

---

## 10. 就绪度评估（Readiness）
- **测试与质量**：手动测试通过，但仍可能存在未覆盖场景
- **部署**：未部署（不作为 Epic 4 阻塞项）
- **干系人验收**：已确认，无需处理
- **技术健康**：代码库偏脆弱；主要担忧为多端同步链路与关键交互回归
- **阻塞项**：无
- **结论**：故事层面已就绪，存在并行治理风险项

---

## 11. 重大变更检测（Significant Changes）
- **未发现需要调整 Epic 4 范围的重大变化**。核心是准备项与质量门槛强化。

---

## 12. 结论
Epic 2 在功能交付上完成度高，但流程与质量门槛需要升级。Epic 4 将以 BPMN 审批状态机为核心，在 Spec Gate 与回归清单的硬门槛下推进，实现“流程正确 + 质量稳定 + 可回归”。

---
*Signed: Bob (Scrum Master)*
