# Validation Report

**Document:** `docs/sprint-artifacts/5-1-template-library.md`  
**Checklist:** `_bmad/bmm/workflows/4-implementation/create-story/checklist.md`  
**Date:** 2026-01-01T19-25-34+0800

## Summary

- Overall: **30/72 passed** (41.7%); Partial: 34; Fail: 8
- Critical Issues: **4**
  1. **Route/URL mismatch:** Story + sample E2E navigate to non-existent `/workspace/...` routes.
  2. **Template instantiate → Node props risk:** Plan doesn’t initialize polymorphic extension tables for non-`ORDINARY` nodes (TASK/REQUIREMENT/PBS/DATA/APP).
  3. **AC4 gap:** “系统模板管理/版本流转”缺少对应的 API/权限/任务拆解（create/update/delete/publish/deprecate）。
  4. **Test + path inconsistencies:** Commands and file paths don’t match repo scripts/structure; likely to fail CI/dev runs.

## Section Results

### Critical Mistakes to Prevent
Pass Rate: 4/8 (50%)

✓ PASS — Reinventing wheels  
Evidence: Reuse guidance is explicit (plugin/repo/hook/dialog patterns) (`docs/sprint-artifacts/5-1-template-library.md:1148-1167`, `docs/sprint-artifacts/5-1-template-library.md:1379-1389`).  
Impact: Low risk of duplicating existing patterns.

✓ PASS — Wrong libraries  
Evidence: Stack/version table matches repo deps (Next 16.0.7, React 19.1.0, Nest 11.1.9) (`docs/sprint-artifacts/5-1-template-library.md:1169-1188`; `apps/web/package.json:35-38`; `apps/api/package.json:23-31`).  
Impact: Reduced chance of picking incompatible tooling.

⚠ PARTIAL — Wrong file locations  
Evidence: Good file list exists (`docs/sprint-artifacts/5-1-template-library.md:1189-1226`), but there are concrete inconsistencies:
- Router target uses `/workspace/...` (`docs/sprint-artifacts/5-1-template-library.md:297`) while app routes are `/graph/[graphId]` (`apps/web/app/graphs/page.tsx:23`) and E2E helpers use `/graph/{id}` (`apps/web/e2e/testUtils.ts:10`).  
- Web test paths differ between Tasks vs File List (`docs/sprint-artifacts/5-1-template-library.md:336` vs `docs/sprint-artifacts/5-1-template-library.md:1222-1224`).  
Impact: Dev may implement correct code but wire to wrong pages/tests, causing “done but broken”.

⚠ PARTIAL — Breaking regressions  
Evidence: Strong test intent (unit + component + E2E) (`docs/sprint-artifacts/5-1-template-library.md:300-366`, `docs/sprint-artifacts/5-1-template-library.md:1124-1142`), but sample E2E assumes `/workspace/project-1` (`docs/sprint-artifacts/5-1-template-library.md:891-909`) which is not a real route.  
Impact: Regression safety net may not execute; failures become late surprises.

✓ PASS — Ignoring UX  
Evidence: Explicit UI/UX constraints + Magic UI styling guidance (`docs/sprint-artifacts/5-1-template-library.md:1287-1302`).  
Impact: Dev has concrete UX guardrails.

⚠ PARTIAL — Vague implementations  
Evidence: Instantiation has key undefined/missing mechanics (node props + routing):
- Instantiation tasks omit initializing node-type extension tables (`docs/sprint-artifacts/5-1-template-library.md:185-193`) even though the runtime expects `taskProps/requirementProps/...` (`apps/api/src/modules/collab/collab.service.ts:139-150`) and node creation normally initializes extension tables (`packages/plugins/plugin-mindmap-core/src/server/nodes/nodes.service.ts:231-233`).  
- Navigation instruction points to non-existent route (`docs/sprint-artifacts/5-1-template-library.md:297`).  
Impact: Likely “works for ORDINARY-only templates” but breaks for seeded TASK/REQUIREMENT nodes.

⚠ PARTIAL — Lying about completion  
Evidence: AC4 promises admin management + version lifecycle (`docs/sprint-artifacts/5-1-template-library.md:40-45`), but tasks only list read APIs + instantiate (`docs/sprint-artifacts/5-1-template-library.md:199-203`) and repository mentions create only (no update/delete/publish transitions) (`docs/sprint-artifacts/5-1-template-library.md:174`).  
Impact: Story can be marked done while AC4 remains unimplemented or partially implemented.

✓ PASS — Not learning from past work  
Evidence: References to established patterns and prior assets (`docs/sprint-artifacts/5-1-template-library.md:1379-1389`).  
Impact: Builds on existing conventions instead of re-inventing.

### Step 1: Load and Understand the Target
Pass Rate: 6/6 (100%)

✓ PASS — Load the workflow configuration  
Evidence: Workflow defines checklist path via `validation: .../checklist.md` (`_bmad/bmm/workflows/4-implementation/create-story/workflow.yaml:14-19`).

✓ PASS — Load the story file  
Evidence: Story located at `docs/sprint-artifacts/5-1-template-library.md` (validated via file scan + content).

✓ PASS — Load validation framework  
Evidence: Validation process/report format defined (`_bmad/core/tasks/validate-workflow.xml:1-79`).

✓ PASS — Extract metadata (epic/story key/title)  
Evidence: Title/number present (`docs/sprint-artifacts/5-1-template-library.md:1`); Epic 5.1 exists (`docs/epics.md:452-466`).

✓ PASS — Resolve workflow variables  
Evidence: Output folder resolves to `docs` (`_bmad/bmm/config.yaml:1-14`); story lives in `docs/sprint-artifacts/` (document path).

✓ PASS — Understand current status  
Evidence: `Status: ready-for-dev` (`docs/sprint-artifacts/5-1-template-library.md:3`).

### Step 2.1: Epics and Stories Analysis
Pass Rate: 3/5 (60%)

⚠ PARTIAL — Epic objectives and business value  
Evidence: Epic objective is only explicit in epics file (`docs/epics.md:448-450`). Story links a tech spec with rationale (`docs/sprint-artifacts/5-1-template-library.md:6`; `docs/sprint-artifacts/tech-spec-5-1-template-library.md:12-27`) but story itself doesn’t summarize the “why”.  
Impact: Dev may miss rationale if they don’t open the tech spec.

✓ PASS — All stories in this epic (cross-story context)  
Evidence: Dependencies/follow-ups listed (`docs/sprint-artifacts/5-1-template-library.md:1391-1397`).

✓ PASS — Specific story requirements and acceptance criteria  
Evidence: Story matches Epic 5.1 core ACs (template list → instantiate → classification) (`docs/epics.md:460-465`; `docs/sprint-artifacts/5-1-template-library.md:18-38`).

⚠ PARTIAL — Technical requirements and constraints  
Evidence: Good constraints exist (Hook-First, plugin protocol, repo pattern) (`docs/sprint-artifacts/5-1-template-library.md:1148-1163`), but there are correctness gaps (route + test scripts) (`docs/sprint-artifacts/5-1-template-library.md:297`, `docs/sprint-artifacts/5-1-template-library.md:1126-1139`; `apps/web/package.json:5-13`).  
Impact: Incorrect constraints cause wasted effort and false confidence.

✓ PASS — Cross-story dependencies and prerequisites  
Evidence: “前置: 无（Epic 5 首个 Story）” + follow-ups (`docs/sprint-artifacts/5-1-template-library.md:1393-1397`).  
Impact: Clear sequencing.

### Step 2.2: Architecture Deep-Dive
Pass Rate: 2/9 (22.2%)

✓ PASS — Technical stack with versions  
Evidence: Versions listed in story (`docs/sprint-artifacts/5-1-template-library.md:1169-1188`) and match repo (`apps/web/package.json:35-40`; `apps/api/package.json:23-31`).

✓ PASS — Code structure and organization patterns  
Evidence: Explicit file plan across `packages/` and `apps/` (`docs/sprint-artifacts/5-1-template-library.md:1189-1226`).

⚠ PARTIAL — API design patterns and contracts  
Evidence: Endpoints are specified (`docs/sprint-artifacts/5-1-template-library.md:199-203`) but UX navigation uses an invalid route (`docs/sprint-artifacts/5-1-template-library.md:297`) vs actual app navigation (`apps/web/app/graphs/page.tsx:23`).  
Impact: Correct backend can still result in broken UX flow.

⚠ PARTIAL — Database schemas and relationships  
Evidence: Schema design is present (`docs/sprint-artifacts/5-1-template-library.md:63-111`), but usage log fields don’t define relations to `User`/`Graph` even though those models exist (`packages/database/prisma/schema.prisma:25-72`).  
Impact: Harder joins/constraints; easier to accumulate orphaned logs.

⚠ PARTIAL — Security requirements and patterns  
Evidence: Story notes “复用权限检查中间件/Guard” (`docs/sprint-artifacts/5-1-template-library.md:1404`), but does not define admin authentication/authorization model for AC4 management endpoints (`docs/sprint-artifacts/5-1-template-library.md:40-45`).  
Impact: High risk of shipping admin mutation endpoints without proper protection.

⚠ PARTIAL — Performance requirements and optimization strategies  
Evidence: Search/filter/pagination are mentioned (`docs/sprint-artifacts/5-1-template-library.md:170-173`), but no constraints on list size, indexes for search, or rate limits.  
Impact: Potential performance regressions as template count grows.

⚠ PARTIAL — Testing standards and frameworks  
Evidence: Test plan is extensive (`docs/sprint-artifacts/5-1-template-library.md:300-366`), but commands don’t match repo scripts (`docs/sprint-artifacts/5-1-template-library.md:1126-1139`; `apps/web/package.json:10-13`).  
Impact: Tests may not run as written; reduces confidence.

⚠ PARTIAL — Deployment and environment patterns  
Evidence: Story doesn’t mention the Next.js `/api` rewrite mechanism or required env vars for API base URLs (`apps/web/next.config.ts:1-14`).  
Impact: Increased setup friction; local/prod parity risk.

⚠ PARTIAL — Integration patterns and external services  
Evidence: Instantiation must work with Yjs collaboration fallback-to-relational behavior (`apps/api/src/modules/collab/collab.service.ts:126-216`), but the story only mentions “ensure template JSON matches Yjs” at a high level (`docs/sprint-artifacts/5-1-template-library.md:1403`).  
Impact: Risk of “nodes exist in DB but don’t behave correctly in editor”.

### Step 2.3: Previous Story Intelligence
Pass Rate: 4/6 (66.7%)

✓ PASS — Dev notes and learnings  
Evidence: Hook-First motivations and pitfalls are documented in Story 7.2 (`docs/sprint-artifacts/story-7-2-frontend-hook-first-extraction.md:7-14`).

⚠ PARTIAL — Review feedback and corrections needed  
Evidence: Similar UI refactors required multiple rounds of accuracy fixes (example: Story 7.5 validation noted invalid commands) (`docs/sprint-artifacts/validation-report-2025-12-30T17-22-09+0800.md:18-33`).  
Impact: This story still repeats “invalid route/test command” issues.

✓ PASS — Files created/modified and their patterns  
Evidence: Plugin packages follow a consistent pattern (e.g., plugin-comments) (`packages/plugins/plugin-comments/package.json:1-57`; `packages/plugins/plugin-comments/jest.config.js:1-13`).

✓ PASS — Testing approaches that worked/didn't work  
Evidence: Web E2E uses helpers + `/graph/{id}` routing (`apps/web/e2e/testUtils.ts:9-36`).

⚠ PARTIAL — Problems encountered and solutions found  
Evidence: Existing web E2E patterns avoid hard-coded “workspace” routes by creating graphs dynamically (`apps/web/e2e/testUtils.ts:13-36`).  
Impact: Story’s E2E examples hard-code `/workspace/project-1` (`docs/sprint-artifacts/5-1-template-library.md:891-909`).

✓ PASS — Code patterns and conventions established  
Evidence: Node creation initializes extension tables for non-ORDINARY types (`packages/plugins/plugin-mindmap-core/src/server/nodes/nodes.service.ts:231-233`).  
Impact: Provides a concrete precedent for template instantiation behavior.

### Step 2.4: Git History Analysis
Pass Rate: 5/5 (100%)

✓ PASS — Files created/modified in previous work  
Evidence: Recent commits show story artifacts + refactors shipped regularly (`git log -n 10 --oneline` output includes Story 7.9/7.8/7.5 entries).

✓ PASS — Code patterns and conventions used  
Evidence: Conventional commit prefixes present (`git log -n 10 --oneline`).

✓ PASS — Library dependencies added/changed  
Evidence: Web scripts and tooling are standardized in `apps/web/package.json` (`apps/web/package.json:5-13`).

✓ PASS — Architecture decisions implemented  
Evidence: App uses global `/api` prefix (`apps/api/src/main.ts:10-12`) and plugin server modules in kernel (`apps/api/src/app.module.ts:32-43`).

✓ PASS — Testing approaches used  
Evidence: Jest/Vitest/Playwright are standard (`apps/api/package.json:11-13`; `apps/web/package.json:10-13`).

### Step 2.5: Latest Technical Research
Pass Rate: 0/3 (0%)

⚠ PARTIAL — Breaking changes or security updates  
Evidence: Local versions are identified in story (`docs/sprint-artifacts/5-1-template-library.md:1171-1187`) but no external “what changed” notes.  
Impact: Could miss subtle breaking changes (e.g., NestJS module packaging, Prisma JSON handling) that matter for plugin boundaries.

⚠ PARTIAL — Performance improvements or deprecations  
Evidence: No latest research notes for search/pagination/indexing strategy.  
Impact: Might miss best practices for large-template libraries.

⚠ PARTIAL — Best practices for current versions  
Evidence: No version-specific best-practice citations (e.g., Nest dynamic module exports, Prisma JSON typing, Next route rewrites in tests).  
Impact: Higher risk of “works locally only” implementations.

### Step 3.1: Reinvention Prevention Gaps
Pass Rate: 3/3 (100%)

✓ PASS — Wheel reinvention risk  
Evidence: References existing repository + hook + dialog patterns (`docs/sprint-artifacts/5-1-template-library.md:1148-1167`).

✓ PASS — Code reuse opportunities not identified  
Evidence: Reuse points are explicit (plugin-comments, useKnowledge, KnowledgeSearchDialog) (`docs/sprint-artifacts/5-1-template-library.md:1379-1389`).

✓ PASS — Existing solutions not mentioned  
Evidence: Uses existing testing harness patterns (Playwright) and Hook-First references (`apps/web/e2e/testUtils.ts:1-36`; `docs/sprint-artifacts/story-7-2-frontend-hook-first-extraction.md:7-14`).

### Step 3.2: Technical Specification DISASTERS
Pass Rate: 1/5 (20%)

✓ PASS — Wrong libraries/frameworks  
Evidence: Aligns with repo stacks (Shadcn/Magic UI + Nest/Prisma) (`docs/sprint-artifacts/5-1-template-library.md:1169-1188`; `docs/project-context.md:24`).  
Impact: Low risk of framework mismatch.

✗ FAIL — API contract violations  
Evidence: Story instructs navigating to `/workspace/${projectId}/graph/${graphId}` (`docs/sprint-artifacts/5-1-template-library.md:297`) and sample E2E uses `/workspace/project-1` (`docs/sprint-artifacts/5-1-template-library.md:891-909`), but the app uses `/graph/${graphId}` (`apps/web/app/graphs/page.tsx:23`; `apps/web/e2e/testUtils.ts:10`).  
Impact: Guaranteed broken UX/tests if followed verbatim.

⚠ PARTIAL — Database schema conflicts  
Evidence: Template models are additive (no collisions), but classification values are inconsistent across the repo:
- Data node secret levels are `public|internal|secret` (`packages/types/src/node-types.ts:109`; `packages/database/prisma/schema.prisma:192`)  
- Story introduces `confidential` in UI mapping and seed (`docs/sprint-artifacts/5-1-template-library.md:1301-1302`, `docs/sprint-artifacts/5-1-template-library.md:1370-1372`)  
Impact: Type drift / UI bugs unless classification is defined as its own enum + validated end-to-end.

⚠ PARTIAL — Security vulnerabilities  
Evidence: AC4 includes admin mutation actions (`docs/sprint-artifacts/5-1-template-library.md:40-45`) but no explicit auth model.  
Impact: Risk of exposing template management endpoints without authorization.

⚠ PARTIAL — Performance disasters  
Evidence: List query is described, but no DB index plan for search fields (name/description) and no cursor/limit DoS constraints.  
Impact: Potential slow queries as templates grow.

### Step 3.3: File Structure DISASTERS
Pass Rate: 0/4 (0%)

⚠ PARTIAL — Wrong file locations  
Evidence: Strong path plan exists, but key mismatches remain (route + tests path) (`docs/sprint-artifacts/5-1-template-library.md:297`, `docs/sprint-artifacts/5-1-template-library.md:336`, `docs/sprint-artifacts/5-1-template-library.md:1222-1224`).  
Impact: Implementation churn and broken wiring.

⚠ PARTIAL — Coding standard violations  
Evidence: Story expects plugin unit tests (`docs/sprint-artifacts/5-1-template-library.md:302-321`) but doesn’t include the standard plugin Jest setup file(s) seen in other plugins (`packages/plugins/plugin-comments/jest.config.js:1-13`).  
Impact: Tests may be added but not runnable.

✗ FAIL — Integration pattern breaks  
Evidence: Seed templates contain non-ORDINARY node types (`docs/sprint-artifacts/5-1-template-library.md:1315-1343`), but instantiation plan doesn’t cover initializing the corresponding extension tables (contrast `packages/plugins/plugin-mindmap-core/src/server/nodes/nodes.service.ts:231-233`).  
Impact: Task/Requirement/PBS/Data/App nodes may render without props or break property panel expectations.

⚠ PARTIAL — Deployment failures  
Evidence: Story doesn’t list required dependency wiring (e.g., adding `@cdm/plugin-template` to `apps/api` deps) even though other plugins are explicit dependencies (`apps/api/package.json:16-21`).  
Impact: Build/import failures during integration.

### Step 3.4: Regression DISASTERS
Pass Rate: 0/4 (0%)

⚠ PARTIAL — Breaking changes  
Evidence: Entry point “新建文件 → 从模板创建” is not mapped to current UI (`apps/web/app/graphs/page.tsx:20-33`).  
Impact: Dev may bolt-on to the wrong place or inadvertently break existing “创建新图谱”.

✗ FAIL — Test failures  
Evidence: Story’s test commands don’t match actual scripts (`docs/sprint-artifacts/5-1-template-library.md:1126-1139`; `apps/web/package.json:10-13`) and sample E2E uses an invalid route (`docs/sprint-artifacts/5-1-template-library.md:891-909`).  
Impact: Tests likely fail to execute; CI confidence drops.

⚠ PARTIAL — UX violations  
Evidence: UX spec exists, but “where this UI lives” and “how it composes with Graphs list/create flow” isn’t concretely specified (no reference UI mock for `/graphs` create button).  
Impact: Easy to regress or create inconsistent entry points.

⚠ PARTIAL — Learning failures  
Evidence: Story references patterns but still repeats previously caught failure mode: invalid routes/commands (compare prior validation focus on correctness) (`docs/sprint-artifacts/validation-report-2025-12-30T17-22-09+0800.md:18-33`).  
Impact: Avoidable rework.

### Step 3.5: Implementation DISASTERS
Pass Rate: 0/4 (0%)

⚠ PARTIAL — Vague implementations  
Evidence: “计算节点坐标 (x, y)” is required (`docs/sprint-artifacts/5-1-template-library.md:191-193`) but no algorithm or baseline is defined; also “继承样式和属性字段” is not mapped to Node schema/extension tables (`docs/sprint-artifacts/5-1-template-library.md:36-37`).  
Impact: Different devs implement incompatible layouts/props.

✗ FAIL — Completion lies  
Evidence: AC4 promises admin management + version lifecycle, but there’s no task breakdown for mutation endpoints and auth (`docs/sprint-artifacts/5-1-template-library.md:40-45`, `docs/sprint-artifacts/5-1-template-library.md:199-203`).  
Impact: Story can ship without delivering AC4.

⚠ PARTIAL — Scope creep  
Evidence: The story bundles DB, backend plugin, frontend UI, and a very large embedded test design including full code blocks (`docs/sprint-artifacts/5-1-template-library.md:368-1107`).  
Impact: Harder to execute in one sprint; token budget waste for dev agent.

⚠ PARTIAL — Quality failures  
Evidence: Testing is planned, but runnable commands/paths are inconsistent; seed integration with existing `db:seed` isn’t specified (`packages/database/package.json:17`; `packages/database/prisma/seed.ts:1-43`).  
Impact: Likely to miss real end-to-end verification.

### Step 4: LLM Optimization Issues
Pass Rate: 1/5 (20%)

✗ FAIL — Verbosity problems  
Evidence: Story is ~1425 lines and includes long embedded example tests (`docs/sprint-artifacts/5-1-template-library.md:368-1107`; `wc -l` shows 1425).  
Impact: Critical instructions are harder to find; dev agent context may truncate.

⚠ PARTIAL — Ambiguity issues  
Evidence: Entry route and navigation are incorrect/ambiguous (`docs/sprint-artifacts/5-1-template-library.md:19-21`, `docs/sprint-artifacts/5-1-template-library.md:297`).  
Impact: Multiple interpretations; higher defect risk.

✗ FAIL — Context overload  
Evidence: Large inlined test code duplicates “Tasks/Test Design” intent (`docs/sprint-artifacts/5-1-template-library.md:368-1107`).  
Impact: More tokens with limited additional constraints.

✗ FAIL — Missing critical signals  
Evidence: No explicit requirement to initialize extension tables for non-ORDINARY nodes, despite seeded node types (`docs/sprint-artifacts/5-1-template-library.md:1315-1343`).  
Impact: Likely functional gaps in created graphs.

✓ PASS — Poor structure (not observed)  
Evidence: Clear phases, tasks, Dev Notes, References are present (`docs/sprint-artifacts/5-1-template-library.md:55-217`, `docs/sprint-artifacts/5-1-template-library.md:1146-1238`, `docs/sprint-artifacts/5-1-template-library.md:1377-1425`).

### Step 4: LLM Optimization Principles
Pass Rate: 1/5 (20%)

⚠ PARTIAL — Clarity over verbosity  
Evidence: Requirements are clear but drowned by large embedded examples (`docs/sprint-artifacts/5-1-template-library.md:368-1107`).  
Impact: Lower signal-to-noise.

⚠ PARTIAL — Actionable instructions  
Evidence: Tasks are actionable, but key correctness gaps remain (routing, extension tables, AC4 mutation endpoints) (`docs/sprint-artifacts/5-1-template-library.md:185-203`, `docs/sprint-artifacts/5-1-template-library.md:297`).  
Impact: Dev must do extra discovery.

✓ PASS — Scannable structure  
Evidence: Headings + phases + task checklists (`docs/sprint-artifacts/5-1-template-library.md:55-366`, `docs/sprint-artifacts/5-1-template-library.md:1146-1238`).

✗ FAIL — Token efficiency  
Evidence: Inlined long test examples could be moved to separate docs or reduced to test case lists (`docs/sprint-artifacts/5-1-template-library.md:368-1107`).  
Impact: Dev agent context truncation risk.

⚠ PARTIAL — Unambiguous language  
Evidence: “新建文件/工作区” terminology conflicts with actual app routes (`apps/web/app/graphs/page.tsx:20-33`).  
Impact: Dev may implement in wrong entry point.

### Step 5: Improvement Recommendations (Meta)
Pass Rate: 0/4 (0%)

➖ N/A — 5.1 Critical Misses (Must Fix)  
Evidence: Meta instruction for validator.

➖ N/A — 5.2 Enhancement Opportunities (Should Add)  
Evidence: Meta instruction for validator.

➖ N/A — 5.3 Optimization Suggestions (Nice to Have)  
Evidence: Meta instruction for validator.

➖ N/A — 5.4 LLM Optimization Improvements  
Evidence: Meta instruction for validator.

### Competition Success Metrics (Meta)
Pass Rate: 0/3 (0%)

➖ N/A — Category 1: Critical Misses (Blockers)  
Evidence: Meta success metric.

➖ N/A — Category 2: Enhancement Opportunities  
Evidence: Meta success metric.

➖ N/A — Category 3: Optimization Insights  
Evidence: Meta success metric.

### Interactive Improvement Process (Meta)
Pass Rate: 0/4 (0%)

➖ N/A — Step 5: Present Improvement Suggestions  
Evidence: Process guidance for follow-up.

➖ N/A — Step 6: Interactive User Selection  
Evidence: Process guidance for follow-up.

➖ N/A — Step 7: Apply Selected Improvements  
Evidence: Process guidance for follow-up.

➖ N/A — Step 8: Confirmation  
Evidence: Process guidance for follow-up.

### Competitive Excellence Mindset (Meta)
Pass Rate: 0/3 (0%)

➖ N/A — Success Criteria for improved stories  
Evidence: Motivational guidance.

➖ N/A — “Every improvement should make it impossible” guidance  
Evidence: Motivational guidance.

➖ N/A — LLM optimization should make it impossible guidance  
Evidence: Motivational guidance.

## Failed Items

1) ✗ FAIL — API contract violations  
Recommendation:
- Replace `/workspace/...` navigation + E2E URLs with the real app routes (`/graphs` entry, `/graph/{graphId}?userId=...`).

2) ✗ FAIL — Integration pattern breaks  
Recommendation:
- In instantiate flow, ensure non-ORDINARY nodes create/initialize the correct extension tables (mirror `NodesService.createNode()` behavior or reuse it).

3) ✗ FAIL — Test failures  
Recommendation:
- Update test commands to match repo scripts (`apps/web/package.json:10-13`) and update E2E to use `gotoTestGraph()` helper (`apps/web/e2e/testUtils.ts:33-36`).

4) ✗ FAIL — Completion lies  
Recommendation:
- Either (a) add concrete admin endpoints + auth tasks for AC4, or (b) move AC4 into a follow-up story and narrow scope.

5) ✗ FAIL — Verbosity problems  
Recommendation:
- Move long example test code into separate `tech-spec` appendices or reduce to test case lists; keep the story as an execution checklist.

6) ✗ FAIL — Context overload  
Recommendation:
- Keep only essential snippets (API routes, DTO shapes) in story; link out to tech spec for full examples.

7) ✗ FAIL — Missing critical signals  
Recommendation:
- Add a dedicated “Instantiation correctness” section: routing, extension tables, default node sizes, parentId edge generation expectations (align with `CollabService` relational fallback).

8) ✗ FAIL — Token efficiency  
Recommendation:
- De-duplicate “Tasks vs Test Design vs embedded code”; choose a single canonical representation.

## Partial Items

- Wrong file locations; Breaking regressions; Vague implementations; Lying about completion
- Epic objectives; Technical requirements/constraints
- API design patterns; DB relationships; Security; Performance; Testing; Deployment; Integration
- Review feedback; Problems/solutions; Breaking changes research; Performance research; Best-practices research
- DB schema conflicts; Security vulnerabilities; Performance disasters
- Wrong file locations; Coding standard violations; Deployment failures
- Breaking changes; UX violations; Learning failures
- Vague implementations; Scope creep; Quality failures
- Ambiguity issues
- Clarity over verbosity; Actionable instructions; Unambiguous language

## Recommendations

1) Must Fix
   - Correct all `/workspace/...` routes in story (UI navigation + E2E) to match actual `/graph/{graphId}` routing.
   - Define/implement **extension table initialization** for template nodes with non-ORDINARY types (TASK/REQUIREMENT/PBS/DATA/APP).
   - Resolve **AC4 scope**: add mutation APIs + auth + tasks, or explicitly defer AC4 to a follow-up story.
   - Fix test commands/paths to match repo scripts and E2E helpers.

2) Should Improve
   - Define classification semantics (is it separate from Data.secretLevel?) and enforce via enum + validation; reconcile `confidential`.
   - Add relation fields for `TemplateUsageLog.user` and `TemplateUsageLog.graph` for integrity.
   - Specify instantiation layout baseline (default x/y strategy, node width/height, parentId expectations).
   - Add explicit dependency wiring steps: add `@cdm/plugin-template` to `apps/api` workspace deps; update seed integration (`packages/database/prisma/seed.ts`).

3) Consider
   - Extract long embedded test code into `docs/sprint-artifacts/tech-spec-5-1-template-library.md` appendices; keep story shorter.
   - Add a small UX mock or screenshot reference for “从模板创建” entry in `/graphs` header button.

