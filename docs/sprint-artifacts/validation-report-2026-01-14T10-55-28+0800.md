# Validation Report

**Document:** docs/sprint-artifacts/9-10-property-panel-asset-binding.md  
**Checklist:** _bmad/bmm/workflows/4-implementation/create-story/checklist.md  
**Date:** 2026-01-14T10-55-28+0800  
**Agent Model:** GPT-5.2 (Codex CLI)

## Summary
- Overall: 22/80 passed (27.5%); Partial: 45; Fail: 6; N/A: 7
- Critical Issues: 6

## Section Results

### Critical Mistakes to Prevent
Pass Rate: 1/8 (12.5%)

⚠ PARTIAL — Reinventing wheels  
Evidence: Story asks to “修改 `AssetCard.tsx` 添加 checkbox” (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:150-154`), but `AssetCard` already supports selection checkboxes via `selectable/selected/onSelectChange` (`apps/web/features/data-library/components/AssetCard.tsx:175-189`).  
Impact: Dev may duplicate selection logic and introduce regressions across existing “batch select/delete” flows.

⚠ PARTIAL — Wrong libraries  
Evidence: Story uses `LinkType`/`LinkType.REFERENCE` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:236,368-369`), but the repo uses `DataLinkType` = `'input'|'output'|'reference'` (`packages/types/src/data-library-types.ts:35`) and no `LinkType` enum exists.  
Impact: Dev may add unnecessary enums/types or wire the wrong values (e.g., `'REFERENCE'` vs `'reference'`), breaking validation and API contracts.

✗ FAIL — Wrong file locations  
Evidence: Story points to `apps/web/app/(graph)/layout.tsx` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:134-135,212-220,387-389`) but the graph route is implemented in `apps/web/app/graph/[graphId]/page.tsx` (no `(graph)` layout exists). It also references `apps/web/features/property-panel/components/LinkedAssetsSection.tsx` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:390,462`) but the real file is `apps/web/components/PropertyPanel/LinkedAssetsSection.tsx` (`apps/web/components/PropertyPanel/LinkedAssetsSection.tsx:1-40`).  
Impact: Dev will edit nonexistent paths, losing time and shipping partial features.

⚠ PARTIAL — Breaking regressions  
Evidence: Entering binding mode forces org view to “folder” (AC1), but current drawer resets filters on orgView changes (`apps/web/features/data-library/components/DataLibraryDrawer.tsx:153-164`) and also has an existing selection set for batch delete (`apps/web/features/data-library/components/DataLibraryDrawer.tsx:145-148`). Auto-opening the drawer cannot be done from inside `DataLibraryDrawer` alone because open state lives in `TopBar` (`apps/web/components/layout/TopBar.tsx:54-56,195-200`).  
Impact: “Binding mode” may unexpectedly clear filters, conflict with existing selection UX, or simply fail to open the drawer (incomplete AC1/AC4).

✓ PASS — Ignoring UX  
Evidence: High-fidelity mock + detailed UI specs for Banner/Tray are provided (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:68-103`), with a referenced prototype image (`docs/prototypes/binding_mode_ui_mockup.png`).  

⚠ PARTIAL — Vague implementations  
Evidence: Binding state stores only `selectedAssetIds: Set<string>` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:192-206`) but the tray requires rendering asset names/details (AC2). The story also does not specify how to obtain `nodeLabel` for the banner, while current PropertyPanel forms only receive `nodeId` + `initialData` (`apps/web/components/PropertyPanel/TaskForm.tsx:24-35`).  
Impact: Dev will need to invent missing data-flow, leading to inconsistent UX and extra refactors.

✗ FAIL — Lying about completion  
Evidence: The story is `ready-for-dev` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:3`), but the test matrix marks “覆盖状态” as “✅ 完整” for all ACs (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:470-476`).  
Impact: Reviewers and dev agents may assume coverage exists and under-test the feature.

⚠ PARTIAL — Not learning from past work  
Evidence: Story references prior stories (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:456-458`) but repeats known repo-specific details incorrectly (query key + file paths). Existing property panel data refresh uses React Query key `['node-asset-links', nodeId]` (`apps/web/features/data-library/hooks/useAssetLinks.ts:50-58`), while the story uses `['assetLinks', nodeId]` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:160,533`).  
Impact: High probability of stale PropertyPanel data after binding and mismatched caches.

---

### Step 1: Load and Understand the Target
Pass Rate: 6/6 (100.0%)

✓ PASS — Load the workflow configuration  
Evidence: Workflow config exists (`_bmad/bmm/workflows/4-implementation/create-story/workflow.yaml:1-40`).  

✓ PASS — Load the story file  
Evidence: Story file exists with title + status (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:1-3`).  

✓ PASS — Load validation framework  
Evidence: Validation framework defined (`_bmad/core/tasks/validate-workflow.xml:1-88`).  

✓ PASS — Extract metadata (epic/story key/title)  
Evidence: Story title indicates 9.10 (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:1`).  

✓ PASS — Resolve workflow variables  
Evidence: `output_folder` and `sprint_artifacts` are defined (`_bmad/bmm/config.yaml:8-14`; `_bmad/bmm/workflows/4-implementation/create-story/workflow.yaml:6-13`).  

✓ PASS — Understand current status  
Evidence: Status is `ready-for-dev` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:3`).  

---

### Step 2.1: Epics and Stories Analysis
Pass Rate: 2/6 (33.3%)

✓ PASS — Load epics file  
Evidence: Epic 9 is present (`docs/epics.md:1055`).  

✓ PASS — Epic objectives and business value  
Evidence: Epic 9 goal: Data Library + industrial preview (`docs/epics.md:1055-1057`).  

⚠ PARTIAL — ALL stories in this epic (cross-story context)  
Evidence: Epic 9 lists 9.1–9.8 only (`docs/epics.md:1059-1270`); Story 9.9/9.10 exist in sprint-artifacts but are missing from epics.  
Impact: Sprint planning and cross-story dependency tracking can drift; dev may miss required prerequisite behaviors from 9.5/9.9.

⚠ PARTIAL — Story requirements and acceptance criteria alignment  
Evidence: Story aligns with the dedicated plan doc (`docs/plans/story-9-10-property-panel-asset-binding.md:1-80`), but is not represented in `docs/epics.md`.  
Impact: “Source-of-truth” confusion: epic view won’t capture the story’s ACs or sequencing.

⚠ PARTIAL — Technical requirements and constraints  
Evidence: Story includes guardrails and file organization (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:224-355`) but contains incorrect repo constraints (wrong file paths; wrong types).  
Impact: Dev may implement against incorrect structure, causing integration failures.

⚠ PARTIAL — Cross-story dependencies and prerequisites  
Evidence: Story references 9.8/9.9 and mentions impact (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:425-433`), but misses the most direct predecessor: Story 9.5’s PropertyPanel linking patterns and query keys (`apps/web/features/data-library/hooks/useAssetLinks.ts:50-58`).  
Impact: Cache invalidation / UI refresh may be implemented incorrectly.

---

### Step 2.2: Architecture Deep-Dive
Pass Rate: 2/10 (20.0%)

⚠ PARTIAL — Technical stack with versions (languages, frameworks, libraries)  
Evidence: Repo versions are defined in project context (`docs/project-context.md:12-43`), but the story does not anchor key implementation constraints to those versions.  
Impact: Dev may pick inconsistent patterns (e.g., toast system, animation utilities) when adding new UI.

⚠ PARTIAL — Code structure and organization patterns  
Evidence: Story proposes feature-sliced placement under `apps/web/features/data-library/...` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:326-355`), but also cites incorrect app/property-panel paths (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:387-391,462`).  
Impact: Wrong structure leads to broken imports, missing providers, and slower reviews.

✗ FAIL — API design patterns and contracts  
Evidence: Story includes a nonexistent “existing” endpoint `GET /api/nodes/:nodeId/data-assets` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:377`) and uses `LinkType` in the batch contract (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:365-375`). Actual link APIs are under `/api/data-assets/links...` (`apps/api/src/modules/data-management/data-asset.controller.ts:312-396`) and types use `DataLinkType` (`packages/types/src/data-library-types.ts:35`).  
Impact: Dev can ship incorrect endpoints or mismatched DTOs, breaking FE/BE integration.

⚠ PARTIAL — Database schemas and relationships  
Evidence: NodeDataLink uses a unique constraint on `(nodeId, assetId)` and default `linkType="reference"` (`packages/database/prisma/schema.prisma:507-525`). Story says “允许重复绑定（后端幂等处理）” (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:443-444`) but does not tie it to the unique constraint + skipDuplicates strategy.  
Impact: Without explicit guidance, dev might implement “loop createLink” and hit `409 Conflict` (`apps/api/src/modules/data-management/node-data-link.service.ts:59-63`).

⚠ PARTIAL — Security requirements and patterns  
Evidence: Existing link creation blocks cross-graph linking (`apps/api/src/modules/data-management/node-data-link.service.ts:39-57`). Story does not call this out as an invariant for batch binding.  
Impact: Missing validations can lead to inconsistent errors or future security regressions.

✓ PASS — Performance requirements  
Evidence: Story defines perf rules (selection P95, Set O(1), 50+ batch) (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:292-317`).  

✓ PASS — Testing standards and frameworks  
Evidence: Explicit unit + E2E coverage tables and file structure are provided (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:466-588`).  

➖ N/A — Deployment and environment patterns  
Evidence: This story is UI + API surface only; no deploy or infra changes required beyond normal CI/CD.  

⚠ PARTIAL — Integration patterns and external services  
Evidence: The drawer open state is owned by TopBar (`apps/web/components/layout/TopBar.tsx:54-56,195-200`), but the story’s “auto open” requirement is specified inside drawer tasks (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:143-148`).  
Impact: Missing cross-component wiring details cause incomplete AC1/AC4 behavior.

➖ N/A — External services (Auth, third-party integrations)  
Evidence: No third-party integration changes are required for binding mode.  

---

### Step 2.3: Previous Story Intelligence
Pass Rate: 2/7 (28.6%)

✓ PASS — Load previous story file  
Evidence: Story references prior Story 9.8/9.9 (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:456-458`).  

⚠ PARTIAL — Dev notes and learnings  
Evidence: Dev Notes include architecture + guardrails, but miss existing implementation facts from Story 9.5: `LinkedAssetsSection` already exists and is wired to `useAssetLinks` with query key `['node-asset-links', nodeId]` (`apps/web/components/PropertyPanel/LinkedAssetsSection.tsx:6-20`; `apps/web/features/data-library/hooks/useAssetLinks.ts:50-58`).  
Impact: High risk of duplicating code or using wrong cache invalidation.

➖ N/A — Review feedback and corrections needed  
Evidence: This story is not yet implemented; no code-review feedback exists to incorporate.  

✓ PASS — Files created/modified and their patterns  
Evidence: Story provides a concrete file touchpoint table (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:381-393`).  

⚠ PARTIAL — Testing approaches that worked/didn’t work  
Evidence: Story proposes new tests but does not reference existing tests that will be impacted (e.g., `apps/web/__tests__/features/data-library/LinkedAssetsSection.test.tsx`).  
Impact: Tests may be duplicated or fail to cover regressions in existing behavior.

⚠ PARTIAL — Problems encountered and solutions found  
Evidence: Story does not mention known UI coupling: TopBar owns `isDataLibraryOpen` (`apps/web/components/layout/TopBar.tsx:54-56`).  
Impact: Implementers will rediscover wiring issues late.

⚠ PARTIAL — Code patterns and conventions established  
Evidence: Story recommends React Context (good), but suggests exporting binding UI state into `@cdm/types` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:109-115,390-392`), which likely over-shares UI-only concepts.  
Impact: Unnecessary shared types increase coupling and maintenance burden.

---

### Step 2.4: Git History Analysis
Pass Rate: 0/5 (0.0%)

⚠ PARTIAL — Files created/modified in previous work  
Evidence: Recent commits exist for 9.5/9.8/9.9 (`git log`: `e63eb83`, `fd3f659`, `4c70cad`), but the story does not cite them.  
Impact: Dev may miss “latest reality” and reintroduce fixed bugs.

⚠ PARTIAL — Code patterns and conventions used  
Evidence: No git-history pointers in story.  
Impact: New code may diverge from recent refactors in DataLibraryDrawer/PropertyPanel.

⚠ PARTIAL — Library dependencies added/changed  
Evidence: No dependency rationale/constraints referenced.  
Impact: Risk of adding new UI libs instead of reusing `@cdm/ui` + existing Tailwind animation utilities.

⚠ PARTIAL — Architecture decisions implemented  
Evidence: No mention of recent architectural decisions affecting drawer ownership/state (TopBar).  
Impact: Auto-open/close wiring remains underspecified.

⚠ PARTIAL — Testing approaches used  
Evidence: No mention of existing tests and conventions; story claims coverage “complete” while not implemented.  
Impact: Increased chance of “green local” but missing real regression coverage.

---

### Step 2.5: Latest Technical Research
Pass Rate: 0/4 (0.0%)

⚠ PARTIAL — Identify libraries/frameworks mentioned  
Evidence: Story references Tailwind + Context, but not key repo frameworks involved in this flow (React Query cache keys, GraphContext/X6 for node label, Sonner toast used in drawer).  
Impact: Dev may implement inconsistent patterns.

➖ N/A — Breaking changes or security updates  
Evidence: No dependency upgrade is part of this story.  

➖ N/A — Performance improvements or deprecations  
Evidence: No library version change is required; only feature logic changes.  

➖ N/A — Best practices for current versions  
Evidence: Not applicable without a dependency/version change request.  

---

### Step 3.1: Reinvention Prevention Gaps
Pass Rate: 0/3 (0.0%)

⚠ PARTIAL — Wheel reinvention  
Evidence: Despite listing “复用现有：`AssetCard`” (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:449-452`), tasks still propose modifying `AssetCard.tsx` for selection (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:150-154`).  
Impact: Duplicate selection implementation increases bug surface.

⚠ PARTIAL — Code reuse opportunities not identified  
Evidence: Existing `useAssetSelection()` already provides Set-based selection helpers (`apps/web/features/data-library/hooks/useAssetSelection.ts:1-78`).  
Impact: Dev may re-implement selection helpers inside the new context.

⚠ PARTIAL — Existing solutions not mentioned  
Evidence: Drawer open state is in `TopBar` (`apps/web/components/layout/TopBar.tsx:54-56`) and there is an existing “Add” entrypoint in PropertyPanel forms that currently only shows a toast (`apps/web/components/PropertyPanel/TaskForm.tsx:54-62`).  
Impact: Story’s “auto open drawer” is likely to be implemented in the wrong layer.

---

### Step 3.2: Technical Specification DISASTERS
Pass Rate: 1/5 (20.0%)

⚠ PARTIAL — Wrong libraries/frameworks  
Evidence: Story uses `LinkType` instead of `DataLinkType` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:236,368-369`; `packages/types/src/data-library-types.ts:35`).  
Impact: Type-level drift between FE/BE.

✗ FAIL — API contract violations  
Evidence: Story claims an “existing” endpoint `GET /api/nodes/:nodeId/data-assets` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:377`) which is not part of current controller surface (`apps/api/src/modules/data-management/data-asset.controller.ts:312-396`).  
Impact: Dev may build against a nonexistent API or add a redundant endpoint.

⚠ PARTIAL — Database schema conflicts  
Evidence: `@@unique([nodeId, assetId])` prevents duplicate links (`packages/database/prisma/schema.prisma:522-525`), while the story says “允许重复绑定” (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:443-444`).  
Impact: Without explicit “skip duplicates” behavior, batch binding can error or produce inconsistent counts.

⚠ PARTIAL — Security vulnerabilities  
Evidence: Cross-graph link is blocked (`apps/api/src/modules/data-management/node-data-link.service.ts:39-57`); story does not require similar validation for batch endpoint.  
Impact: Missing guardrails can produce confusing errors or future bypasses.

✓ PASS — Performance disasters prevented  
Evidence: The story explicitly requires Set-based selection and batch operations (50+) (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:292-317`).  

---

### Step 3.3: File Structure DISASTERS
Pass Rate: 0/4 (0.0%)

✗ FAIL — Wrong file locations  
Evidence: Nonexistent `app/(graph)/layout.tsx` and incorrect PropertyPanel path are cited (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:134-135,387-391,462`).  
Impact: Implementation will be misdirected.

⚠ PARTIAL — Coding standard violations  
Evidence: Story proposes exporting binding UI state into `@cdm/types` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:109-115,390-392`), which may violate “keep shared types for shared domain” and increases coupling.  
Impact: Wider blast radius for future changes.

⚠ PARTIAL — Integration pattern breaks  
Evidence: Story says `DataLibraryDrawer` “监听 Context … 自动打开抽屉” (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:143-148`), but the drawer open/close state is controlled externally by `TopBar` (`apps/web/components/layout/TopBar.tsx:54-56,195-200`).  
Impact: AC1 can’t be met unless TopBar participates.

➖ N/A — Deployment failures  
Evidence: No build/deploy system changes are needed for this feature.  

---

### Step 3.4: Regression DISASTERS
Pass Rate: 1/4 (25.0%)

⚠ PARTIAL — Breaking changes  
Evidence: Forcing folder view triggers filter reset toast and behavior (`apps/web/features/data-library/components/DataLibraryDrawer.tsx:153-164`). Story also says binding mode should not “污染现有 Drawer 状态” (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:304-314`) without reconciling that with current implementation.  
Impact: Users can lose filter context unexpectedly when entering binding mode.

⚠ PARTIAL — Test failures  
Evidence: Story does not call out updates to existing tests in `apps/web/__tests__` that may depend on current “Add asset” behavior (toast-only).  
Impact: Implementation may break existing tests or leave new behavior untested.

✓ PASS — UX violations prevented  
Evidence: UX requirements for banner/tray and confirm/clear behaviors are explicit (AC2/AC4).  

⚠ PARTIAL — Learning failures  
Evidence: Existing query keys and component paths are not reused correctly, despite prior story 9.5 establishing them (`apps/web/features/data-library/hooks/useAssetLinks.ts:50-58`; `apps/web/components/PropertyPanel/LinkedAssetsSection.tsx:1-20`).  
Impact: Repeat bugs and cache drift.

---

### Step 3.5: Implementation DISASTERS
Pass Rate: 0/4 (0.0%)

⚠ PARTIAL — Vague implementations  
Evidence: Story does not specify how SelectedAssetsTray renders selected asset details across folder changes, given only IDs are stored (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:192-206`).  
Impact: Tray UX may be incomplete or inconsistent.

✗ FAIL — Completion lies  
Evidence: The story claims tests are “✅ 完整” while no implementation exists (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:470-476`).  
Impact: Inaccurate project tracking and reduced testing discipline.

⚠ PARTIAL — Scope creep  
Evidence: Story expands scope by pushing UI-only types into shared `@cdm/types` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:109-115,390-392`).  
Impact: Wider dependency changes than required for the feature.

⚠ PARTIAL — Quality failures  
Evidence: Auto-open/close and “clear keeps drawer open” (AC2/AC4) require cross-component state wiring with TopBar but are not fully specified.  
Impact: Feature may ship with broken entry/exit flows.

---

### Step 4: LLM-Dev-Agent Optimization Analysis
Pass Rate: 1/5 (20.0%)

⚠ PARTIAL — Verbosity problems  
Evidence: Story duplicates UI specs in multiple sections (Tailwind block + tables + guardrails) (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:68-103,404-423,224-317`).  
Impact: Dev agent may miss critical integration notes due to token pressure.

⚠ PARTIAL — Ambiguity issues  
Evidence: “自动打开抽屉” is specified at drawer layer, but open-state ownership is in TopBar (missing explicit wiring).  
Impact: Multiple plausible implementations; higher risk of incomplete AC coverage.

⚠ PARTIAL — Context overload  
Evidence: Large guardrail blocks + duplicated specs mixed with tasks.  
Impact: Harder to find the “must implement to pass AC” subset quickly.

⚠ PARTIAL — Missing critical signals  
Evidence: Missing explicit references to `TopBar.tsx` and `LinkedAssetsSection.tsx` real paths and `useAssetLinks` cache key.  
Impact: High chance of wrong integration and stale UI.

✓ PASS — Poor structure  
Evidence: Clear headings for ACs, tasks, API contracts, test plan, and dev record exist.  

---

### Step 4: LLM Optimization Principles
Pass Rate: 2/5 (40.0%)

⚠ PARTIAL — Clarity over verbosity  
Evidence: Critical wiring constraints (TopBar open-state, query keys, existing selection) are not prioritized.  
Impact: Dev may implement UI correctly but miss critical app wiring.

✓ PASS — Actionable instructions  
Evidence: Task list is explicit and maps to ACs (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:107-177`).  

✓ PASS — Scannable structure  
Evidence: Structured sections + tables + matrices.  

⚠ PARTIAL — Token efficiency  
Evidence: Some repeated CSS/table specs could be collapsed into one “source-of-truth” section to reduce length.  
Impact: Increased risk of truncation/missed requirements in LLM execution.

⚠ PARTIAL — Unambiguous language  
Evidence: AC2 “清除选择” semantics are split between “清除目标节点但保持抽屉打开” and “调用 exitBindingMode()” (implied close behavior unclear).  
Impact: Implementation may accidentally close the drawer on clear.

---

### Step 5: Improvement Recommendations
Pass Rate: 4/4 (100.0%)

✓ PASS — Critical Misses (Must Fix)  
Evidence: Addressed in “Recommendations” section below.  

✓ PASS — Enhancement Opportunities (Should Add)  
Evidence: Addressed in “Recommendations” section below.  

✓ PASS — Optimization Suggestions (Nice to Have)  
Evidence: Addressed in “Recommendations” section below.  

✓ PASS — LLM Optimization Improvements  
Evidence: Addressed in “Recommendations” section below.  

---

## Failed Items
- ✗ Wrong file locations: references nonexistent `app/(graph)/layout.tsx` and wrong PropertyPanel paths (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:134-135,387-391,462`).
- ✗ API contract violations: includes nonexistent `GET /api/nodes/:nodeId/data-assets` and wrong `LinkType` usage in batch DTO (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:365-377`).
- ✗ Lying about completion: “覆盖状态 ✅ 完整” while story is `ready-for-dev` (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:3,470-476`).

## Partial Items (Top Risks)
- Auto-open/close drawer wiring missing: TopBar owns `isDataLibraryOpen` (`apps/web/components/layout/TopBar.tsx:54-56`).
- Cache invalidation key mismatch: should align to `['node-asset-links', nodeId]` (`apps/web/features/data-library/hooks/useAssetLinks.ts:50-58`).
- SelectedAssetsTray data model underspecified: needs asset metadata, not only IDs (`docs/sprint-artifacts/9-10-property-panel-asset-binding.md:192-206`).
- “Allow duplicate binding” must reconcile with `@@unique([nodeId, assetId])` (`packages/database/prisma/schema.prisma:522-525`).
- Binding mode vs existing selection/delete flows not specified (`apps/web/features/data-library/components/DataLibraryDrawer.tsx:145-148`).

## Recommendations
1. Must Fix:
   - Correct all file paths: graph route provider integration should reference `apps/web/app/graph/[graphId]/page.tsx`; PropertyPanel components live under `apps/web/components/PropertyPanel/*`; add TopBar as an explicit touchpoint.
   - Fix API contracts: remove the nonexistent `GET /api/nodes/:nodeId/data-assets`; use `DataLinkType` and default `'reference'` consistently; define batch endpoint behavior as idempotent (skip duplicates) to match DB unique constraint.
   - Fix React Query invalidation: invalidate `['node-asset-links', nodeId]` (and any node-view union queries if applicable) after batch bind.
   - Fix “coverage status” wording: mark coverage as “计划/待实现” while `ready-for-dev`.
2. Should Improve:
   - Specify how SelectedAssetsTray gets asset names/details across folder changes (store minimal asset summary in context on selection, or derive from cache).
   - Specify how the banner obtains node label (derive from GraphContext by nodeId, or pass label explicitly).
   - Reconcile binding-mode “force folder view” with existing filter reset behavior (decide: preserve filters vs accept reset).
   - Define interaction between binding selection and existing batch selection/delete features (separate sets or disable delete during binding mode).
3. Consider:
   - Align endpoint naming with existing conventions (e.g., `links:createByAssets` instead of `links:batch`) while keeping route namespace consistent.
   - Add DTO validation for the batch endpoint (nodeId, assetIds, linkType) and return `{ created, skipped }` based on `createMany({ skipDuplicates: true })`.

